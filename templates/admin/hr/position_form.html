{% extends 'base/app_layout.html' %}
{% load static %}

{% block page_title %}{% if object %}Edit{% else %}Add{% endif %} Position{% endblock %}

{% block main_content %}
<div class="space-y-6">
    <!-- Page Header -->
    <div>
        <nav class="flex items-center text-sm text-gray-500 mb-2">
            <a href="{% url 'admin:dashboard' %}" class="hover:text-primary-600">Admin</a>
            <svg class="w-4 h-4 mx-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
            </svg>
            <a href="{% url 'hr_admin:position_list' %}" class="hover:text-primary-600">Positions</a>
            <svg class="w-4 h-4 mx-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
            </svg>
            <span class="text-gray-700">{% if object %}Edit{% else %}Add{% endif %}</span>
        </nav>
        <h1 class="text-2xl font-bold text-gray-900">{% if object %}Edit Position{% else %}Add Position{% endif %}</h1>
    </div>
    
    <!-- Form -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
        <form method="post" enctype="multipart/form-data" class="space-y-6">
            {% csrf_token %}
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="id_code" class="block text-sm font-medium text-gray-700 mb-1">Code *</label>
                    <input type="text" name="code" id="id_code" value="{{ form.code.value|default:'' }}"
                           class="w-full px-4 py-2.5 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-rose-500 focus:border-transparent"
                           placeholder="e.g., SSD-001" required>
                </div>
                
                <div>
                    <label for="id_title" class="block text-sm font-medium text-gray-700 mb-1">Title *</label>
                    <input type="text" name="title" id="id_title" value="{{ form.title.value|default:'' }}"
                           class="w-full px-4 py-2.5 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-rose-500 focus:border-transparent"
                           placeholder="e.g., Senior Software Developer" required>
                </div>
                
                <div>
                    <label for="id_department" class="block text-sm font-medium text-gray-700 mb-1">Department</label>
                    <select name="department" id="id_department"
                            class="w-full px-4 py-2.5 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-rose-500 focus:border-transparent">
                        <option value="">— Company-wide —</option>
                        {% for dept in form.fields.department.queryset %}
                        <option value="{{ dept.pk }}" {% if form.department.value|stringformat:"s" == dept.pk|stringformat:"s" %}selected{% endif %}>{{ dept.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div>
                    <label for="id_reports_to" class="block text-sm font-medium text-gray-700 mb-1">Reports To</label>
                    <select name="reports_to" id="id_reports_to"
                            class="w-full px-4 py-2.5 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-rose-500 focus:border-transparent">
                        <option value="">— None —</option>
                        {% for pos in form.fields.reports_to.queryset %}
                        <option value="{{ pos.pk }}" {% if form.reports_to.value|stringformat:"s" == pos.pk|stringformat:"s" %}selected{% endif %}>{{ pos.title }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            
            <div>
                <label for="id_job_description" class="block text-sm font-medium text-gray-700 mb-1">Job Description Document</label>
                {% if object.job_description %}
                <p class="text-sm text-gray-500 mb-2">Current: <a href="{{ object.job_description.url }}" target="_blank" class="text-rose-600">{{ object.job_description.name }}</a></p>
                {% endif %}
                <input type="file" name="job_description" id="id_job_description"
                       class="w-full px-4 py-2.5 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-rose-500 focus:border-transparent"
                       accept=".pdf,.doc,.docx">
            </div>
            
            <div>
                <label for="id_job_description_text" class="block text-sm font-medium text-gray-700 mb-1">Job Description Text</label>
                <textarea name="job_description_text" id="id_job_description_text" rows="5"
                          class="w-full px-4 py-2.5 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-rose-500 focus:border-transparent"
                          placeholder="Job description summary or full text...">{{ form.job_description_text.value|default:'' }}</textarea>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="id_minimum_qualifications" class="block text-sm font-medium text-gray-700 mb-1">Minimum Qualifications</label>
                    <textarea name="minimum_qualifications" id="id_minimum_qualifications" rows="3"
                              class="w-full px-4 py-2.5 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-rose-500 focus:border-transparent">{{ form.minimum_qualifications.value|default:'' }}</textarea>
                </div>
                
                <div>
                    <label for="id_preferred_qualifications" class="block text-sm font-medium text-gray-700 mb-1">Preferred Qualifications</label>
                    <textarea name="preferred_qualifications" id="id_preferred_qualifications" rows="3"
                              class="w-full px-4 py-2.5 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-rose-500 focus:border-transparent">{{ form.preferred_qualifications.value|default:'' }}</textarea>
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                <div>
                    <label for="id_experience_required" class="block text-sm font-medium text-gray-700 mb-1">Experience Required</label>
                    <input type="text" name="experience_required" id="id_experience_required" value="{{ form.experience_required.value|default:'' }}"
                           class="w-full px-4 py-2.5 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-rose-500 focus:border-transparent"
                           placeholder="e.g., 3-5 years">
                </div>
                
                <div>
                    <label for="id_salary_band" class="block text-sm font-medium text-gray-700 mb-1">Salary Band</label>
                    <select name="salary_band" id="id_salary_band"
                            class="w-full px-4 py-2.5 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-rose-500 focus:border-transparent">
                        <option value="">— Select —</option>
                        {% for value, label in form.fields.salary_band.choices %}
                        {% if value %}
                        <option value="{{ value }}" {% if form.salary_band.value == value %}selected{% endif %}>{{ label }}</option>
                        {% endif %}
                        {% endfor %}
                    </select>
                </div>
                
                <div>
                    <label for="id_salary_min" class="block text-sm font-medium text-gray-700 mb-1">Minimum Salary</label>
                    <input type="number" step="0.01" name="salary_min" id="id_salary_min" value="{{ form.salary_min.value|default:'' }}"
                           class="w-full px-4 py-2.5 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-rose-500 focus:border-transparent">
                </div>
                
                <div>
                    <label for="id_salary_max" class="block text-sm font-medium text-gray-700 mb-1">Maximum Salary</label>
                    <input type="number" step="0.01" name="salary_max" id="id_salary_max" value="{{ form.salary_max.value|default:'' }}"
                           class="w-full px-4 py-2.5 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-rose-500 focus:border-transparent">
                </div>
            </div>
            
            <div class="flex items-center">
                <input type="checkbox" name="is_active" id="id_is_active" {% if form.is_active.value %}checked{% endif %}
                       class="w-4 h-4 text-rose-600 border-gray-300 rounded focus:ring-rose-500">
                <label for="id_is_active" class="ml-2 text-sm font-medium text-gray-700">Active</label>
            </div>
            
            <div class="flex items-center justify-end space-x-4 pt-4 border-t border-gray-100">
                <a href="{% url 'hr_admin:position_list' %}" class="px-4 py-2 text-gray-700 hover:text-gray-900 font-medium transition">
                    Cancel
                </a>
                <button type="submit" class="px-6 py-2.5 bg-rose-600 text-white font-medium rounded-xl hover:bg-rose-700 transition shadow-sm">
                    {% if object %}Update{% else %}Create{% endif %} Position
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

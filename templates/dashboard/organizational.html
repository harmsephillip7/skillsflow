{% extends 'base/app_layout.html' %}
{% load static %}

{% block title %}Organization Dashboard - SkillsFlow{% endblock %}

{% block page_title %}Organization Dashboard{% endblock %}

{% block breadcrumbs %}
<li class="flex items-center">
    <svg class="w-5 h-5 text-gray-400 mx-2" fill="currentColor" viewBox="0 0 20 20">
        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
    </svg>
    <span class="text-gray-700 font-medium">Dashboard</span>
</li>
{% endblock %}

{% block page_actions %}
<div class="flex items-center space-x-3">
    <!-- View Toggle Buttons -->
    <div class="inline-flex rounded-lg border border-gray-300 bg-white p-1" role="group">
        <a href="?view=overview{% if request.GET.campus %}&campus={{ request.GET.campus }}{% endif %}" 
           class="inline-flex items-center px-3 py-1.5 text-sm font-medium rounded-md transition-all duration-200 {% if current_view == 'overview' %}bg-primary-600 text-white shadow-sm{% else %}text-gray-700 hover:bg-gray-100{% endif %}">
            <svg class="w-4 h-4 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
            </svg>
            Overview
        </a>
        <a href="?view=capacity{% if request.GET.campus %}&campus={{ request.GET.campus }}{% endif %}" 
           class="inline-flex items-center px-3 py-1.5 text-sm font-medium rounded-md transition-all duration-200 {% if current_view == 'capacity' %}bg-primary-600 text-white shadow-sm{% else %}text-gray-700 hover:bg-gray-100{% endif %}">
            <svg class="w-4 h-4 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
            </svg>
            Capacity
        </a>
        <a href="?view=projects{% if request.GET.campus %}&campus={{ request.GET.campus }}{% endif %}" 
           class="inline-flex items-center px-3 py-1.5 text-sm font-medium rounded-md transition-all duration-200 {% if current_view == 'projects' %}bg-primary-600 text-white shadow-sm{% else %}text-gray-700 hover:bg-gray-100{% endif %}">
            <svg class="w-4 h-4 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
            </svg>
            Projects
        </a>
        <a href="?view=implementation{% if request.GET.campus %}&campus={{ request.GET.campus }}{% endif %}" 
           class="inline-flex items-center px-3 py-1.5 text-sm font-medium rounded-md transition-all duration-200 {% if current_view == 'implementation' %}bg-primary-600 text-white shadow-sm{% else %}text-gray-700 hover:bg-gray-100{% endif %}">
            <svg class="w-4 h-4 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17V7m0 10a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h2a2 2 0 012 2m0 10a2 2 0 002 2h2a2 2 0 002-2M9 7a2 2 0 012-2h2a2 2 0 012 2m0 10V7m0 10a2 2 0 002 2h2a2 2 0 002-2V7a2 2 0 00-2-2h-2a2 2 0 00-2 2"/>
            </svg>
            Implementation
        </a>
    </div>
    
    <div class="border-l border-gray-300 h-8"></div>
    
    <span class="text-sm text-gray-500">Last updated: {{ quick_stats.today|date:"d M Y" }}</span>
    <button onclick="location.reload()" class="inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-all duration-200">
        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
        </svg>
        Refresh
    </button>
    <button class="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-all duration-200">
        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
        </svg>
        Export Report
    </button>
</div>
{% endblock %}

{% block main_content %}
<div class="space-y-6">
    
    <!-- Alerts Section -->
    {% if alerts %}
    <div class="space-y-3">
        {% for alert in alerts %}
        <div class="{% if alert.level == 'warning' %}bg-yellow-50 border-yellow-400{% elif alert.level == 'error' %}bg-red-50 border-red-400{% else %}bg-blue-50 border-blue-400{% endif %} border-l-4 p-4 rounded-r-lg shadow-sm">
            <div class="flex items-center">
                <div class="flex-shrink-0">
                    {% if alert.level == 'warning' %}
                    <svg class="w-5 h-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                    </svg>
                    {% elif alert.level == 'error' %}
                    <svg class="w-5 h-5 text-red-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
                    </svg>
                    {% else %}
                    <svg class="w-5 h-5 text-blue-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                    </svg>
                    {% endif %}
                </div>
                <div class="ml-3 flex-1">
                    <p class="text-sm {% if alert.level == 'warning' %}text-yellow-700{% elif alert.level == 'error' %}text-red-700{% else %}text-blue-700{% endif %}">
                        {{ alert.message }}
                    </p>
                </div>
                <div class="ml-auto pl-3">
                    <a href="{{ alert.action_url }}" class="text-sm font-medium {% if alert.level == 'warning' %}text-yellow-600 hover:text-yellow-500{% elif alert.level == 'error' %}text-red-600 hover:text-red-500{% else %}text-blue-600 hover:text-blue-500{% endif %}">
                        View Details â†’
                    </a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}
    
    <!-- ==================== CAPACITY VIEW ==================== -->
    {% if current_view == 'capacity' %}
    <div class="space-y-6">
        <!-- Capacity Overview Header -->
        <div class="bg-gradient-to-r from-blue-600 to-blue-800 rounded-xl shadow-lg p-6 text-white">
            <div class="flex items-center justify-between">
                <div>
                    <h2 class="text-2xl font-bold">Campus Capacity Overview</h2>
                    <p class="mt-1 text-blue-100">Monitor classroom, facilitator, and equipment capacity across campuses</p>
                </div>
                <div class="text-right">
                    <p class="text-4xl font-bold" id="header-utilization">{{ capacity.utilization|default:"0" }}%</p>
                    <p class="text-sm text-blue-100">Overall Utilization</p>
                </div>
            </div>
        </div>
        
        <!-- Capacity Type Toggle -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-4">
            <div class="flex items-center justify-between">
                <h3 class="text-sm font-semibold text-gray-700 uppercase tracking-wider">Summary View</h3>
                <div class="inline-flex rounded-lg border border-gray-300 bg-gray-50 p-1" role="group">
                    <button type="button" onclick="switchCapacityView('classroom')" 
                            id="btn-classroom"
                            class="capacity-toggle-btn inline-flex items-center px-4 py-2 text-sm font-medium rounded-md transition-all duration-200 bg-primary-600 text-white shadow-sm">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                        </svg>
                        Classrooms
                    </button>
                    <button type="button" onclick="switchCapacityView('facilitator')" 
                            id="btn-facilitator"
                            class="capacity-toggle-btn inline-flex items-center px-4 py-2 text-sm font-medium rounded-md transition-all duration-200 text-gray-700 hover:bg-gray-100">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
                        </svg>
                        Facilitators
                    </button>
                    <button type="button" onclick="switchCapacityView('equipment')" 
                            id="btn-equipment"
                            class="capacity-toggle-btn inline-flex items-center px-4 py-2 text-sm font-medium rounded-md transition-all duration-200 text-gray-700 hover:bg-gray-100">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                        </svg>
                        Equipment
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Capacity KPI Cards - Classroom (Default) -->
        <!-- Unified Capacity KPI Cards - Updates dynamically based on toggle -->
        <div id="capacity-kpis" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
            <!-- KPI Card 1: Total -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-500 uppercase tracking-wider" id="kpi-label-1">Total Seats</p>
                        <p class="mt-2 text-3xl font-bold text-gray-900" id="kpi-value-1">{{ capacity.total_seats|default:"0" }}</p>
                    </div>
                    <div class="p-4 bg-blue-100 rounded-full" id="kpi-icon-bg-1">
                        <svg class="w-8 h-8 text-blue-600" id="kpi-icon-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                        </svg>
                    </div>
                </div>
            </div>
            
            <!-- KPI Card 2: In Use/Occupied -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-500 uppercase tracking-wider" id="kpi-label-2">Occupied</p>
                        <p class="mt-2 text-3xl font-bold text-gray-900" id="kpi-value-2">{{ capacity.occupied_seats|default:"0" }}</p>
                    </div>
                    <div class="p-4 bg-yellow-100 rounded-full" id="kpi-icon-bg-2">
                        <svg class="w-8 h-8 text-yellow-600" id="kpi-icon-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/>
                        </svg>
                    </div>
                </div>
            </div>
            
            <!-- KPI Card 3: Available -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-500 uppercase tracking-wider" id="kpi-label-3">Available</p>
                        <p class="mt-2 text-3xl font-bold text-green-600" id="kpi-value-3">{{ capacity.available_seats|default:"0" }}</p>
                    </div>
                    <div class="p-4 bg-emerald-100 rounded-full" id="kpi-icon-bg-3">
                        <svg class="w-8 h-8 text-emerald-600" id="kpi-icon-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                    </div>
                </div>
            </div>
            
            <!-- KPI Card 4: Utilization/Rate -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-500 uppercase tracking-wider" id="kpi-label-4">Utilization</p>
                        <p class="mt-2 text-3xl font-bold text-primary-600" id="kpi-value-4">{{ capacity.utilization|default:"0" }}%</p>
                    </div>
                    <div class="p-4 bg-primary-100 rounded-full" id="kpi-icon-bg-4">
                        <svg class="w-8 h-8 text-primary-600" id="kpi-icon-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/>
                        </svg>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Capacity Breakdown -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Classroom Capacity -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-lg font-semibold text-gray-900">Classroom Capacity</h3>
                    <div class="p-2 bg-blue-100 rounded-lg">
                        <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                        </svg>
                    </div>
                </div>
                {% if capacity.classroom_capacity %}
                <div class="space-y-4">
                    {% for item in capacity.classroom_capacity %}
                    <div class="border border-gray-100 rounded-lg p-4 hover:bg-gray-50 transition-colors">
                        <div class="flex justify-between items-start mb-2">
                            <div>
                                <p class="font-medium text-gray-900">{{ item.campus_name }}</p>
                                <p class="text-xs text-gray-500">{{ item.venue_count }} venues</p>
                            </div>
                            <span class="text-lg font-bold {% if item.utilization >= 80 %}text-red-600{% elif item.utilization >= 60 %}text-yellow-600{% else %}text-green-600{% endif %}">{{ item.utilization }}%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="{% if item.utilization >= 80 %}bg-red-500{% elif item.utilization >= 60 %}bg-yellow-500{% else %}bg-green-500{% endif %} h-2 rounded-full transition-all duration-500" style="width: {{ item.utilization }}%"></div>
                        </div>
                        <div class="mt-2 flex justify-between text-xs text-gray-500">
                            <span>{{ item.occupied }} / {{ item.total_capacity }} seats</span>
                            <span>{{ item.available }} available</span>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="text-center py-8">
                    <svg class="w-12 h-12 text-gray-300 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5"/>
                    </svg>
                    <p class="mt-2 text-sm text-gray-500">No classroom data available</p>
                </div>
                {% endif %}
            </div>
            
            <!-- Facilitator Capacity -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-lg font-semibold text-gray-900">Facilitator Capacity</h3>
                    <div class="p-2 bg-purple-100 rounded-lg">
                        <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
                        </svg>
                    </div>
                </div>
                {% if capacity.facilitator_capacity %}
                <div class="space-y-4">
                    {% for item in capacity.facilitator_capacity %}
                    <div class="border border-gray-100 rounded-lg p-4 hover:bg-gray-50 transition-colors">
                        <div class="flex justify-between items-start mb-2">
                            <div>
                                <p class="font-medium text-gray-900">{{ item.campus_name }}</p>
                                <p class="text-xs text-gray-500">{{ item.total_facilitators }} facilitators</p>
                            </div>
                            <span class="text-lg font-bold {% if item.workload >= 80 %}text-red-600{% elif item.workload >= 60 %}text-yellow-600{% else %}text-green-600{% endif %}">{{ item.workload }}%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="{% if item.workload >= 80 %}bg-red-500{% elif item.workload >= 60 %}bg-yellow-500{% else %}bg-green-500{% endif %} h-2 rounded-full transition-all duration-500" style="width: {{ item.workload }}%"></div>
                        </div>
                        <div class="mt-2 flex justify-between text-xs text-gray-500">
                            <span>{{ item.assigned_cohorts }} cohorts assigned</span>
                            <span>{{ item.available_facilitators }} available</span>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="text-center py-8">
                    <svg class="w-12 h-12 text-gray-300 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857"/>
                    </svg>
                    <p class="mt-2 text-sm text-gray-500">No facilitator data available</p>
                </div>
                {% endif %}
            </div>
            
            <!-- Equipment Capacity -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-lg font-semibold text-gray-900">Equipment Capacity</h3>
                    <div class="p-2 bg-orange-100 rounded-lg">
                        <svg class="w-6 h-6 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                        </svg>
                    </div>
                </div>
                {% if capacity.equipment_capacity %}
                <div class="space-y-4">
                    {% for item in capacity.equipment_capacity %}
                    <div class="border border-gray-100 rounded-lg p-4 hover:bg-gray-50 transition-colors">
                        <div class="flex justify-between items-start mb-2">
                            <div>
                                <p class="font-medium text-gray-900">{{ item.campus_name }}</p>
                                <p class="text-xs text-gray-500">{{ item.total_equipment }} items</p>
                            </div>
                            <span class="text-lg font-bold {% if item.utilization >= 80 %}text-red-600{% elif item.utilization >= 60 %}text-yellow-600{% else %}text-green-600{% endif %}">{{ item.utilization }}%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="{% if item.utilization >= 80 %}bg-red-500{% elif item.utilization >= 60 %}bg-yellow-500{% else %}bg-green-500{% endif %} h-2 rounded-full transition-all duration-500" style="width: {{ item.utilization }}%"></div>
                        </div>
                        <div class="mt-2 flex justify-between text-xs text-gray-500">
                            <span>{{ item.in_use }} in use</span>
                            <span>{{ item.available }} available</span>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="text-center py-8">
                    <svg class="w-12 h-12 text-gray-300 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                    </svg>
                    <p class="mt-2 text-sm text-gray-500">No equipment data available</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- ==================== PROJECTS VIEW ==================== -->
    {% elif current_view == 'projects' %}
    <div class="space-y-6">
        <!-- Projects Overview Header -->
        <div class="bg-gradient-to-r from-purple-600 to-purple-800 rounded-xl shadow-lg p-6 text-white">
            <div class="flex items-center justify-between">
                <div>
                    <h2 class="text-2xl font-bold">Projects & Learner Progress</h2>
                    <p class="mt-1 text-purple-100">Track project performance, learner locations, and competency rates</p>
                </div>
                <div class="flex space-x-8">
                    <div class="text-center">
                        <p class="text-3xl font-bold">{{ projects_data.students_on_campus|default:"0" }}</p>
                        <p class="text-sm text-purple-100">On Campus</p>
                    </div>
                    <div class="text-center">
                        <p class="text-3xl font-bold">{{ projects_data.students_in_workplace|default:"0" }}</p>
                        <p class="text-sm text-purple-100">In Workplace</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Learner Location Summary -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
            <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-500">On Campus</p>
                        <p class="mt-2 text-3xl font-bold text-blue-600">{{ projects_data.students_on_campus|default:"0" }}</p>
                    </div>
                    <div class="p-3 bg-blue-100 rounded-full">
                        <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5"/>
                        </svg>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-500">In Workplace</p>
                        <p class="mt-2 text-3xl font-bold text-green-600">{{ projects_data.students_in_workplace|default:"0" }}</p>
                    </div>
                    <div class="p-3 bg-green-100 rounded-full">
                        <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                        </svg>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-500">Active Projects</p>
                        <p class="mt-2 text-3xl font-bold text-purple-600">{{ projects_data.projects|length|default:"0" }}</p>
                    </div>
                    <div class="p-3 bg-purple-100 rounded-full">
                        <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                        </svg>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-500">Avg Competency</p>
                        <p class="mt-2 text-3xl font-bold {% if projects_data.competency_rates.average >= 70 %}text-green-600{% elif projects_data.competency_rates.average >= 50 %}text-yellow-600{% else %}text-red-600{% endif %}">{{ projects_data.competency_rates.average|default:"0" }}%</p>
                    </div>
                    <div class="p-4 {% if projects_data.competency_rates.average >= 70 %}bg-green-100{% elif projects_data.competency_rates.average >= 50 %}bg-yellow-100{% else %}bg-red-100{% endif %} rounded-full">
                        <svg class="w-6 h-6 {% if projects_data.competency_rates.average >= 70 %}text-green-600{% elif projects_data.competency_rates.average >= 50 %}text-yellow-600{% else %}text-red-600{% endif %}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"/>
                        </svg>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Progress Distribution -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Learner Progress Breakdown -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                <h3 class="text-lg font-semibold text-gray-900 mb-6">Learners by Study Year</h3>
                <div class="space-y-4">
                    {% if projects_data.by_progress %}
                    {% for year, count in projects_data.by_progress.items %}
                    <div>
                        <div class="flex justify-between text-sm mb-1">
                            <span class="text-gray-600">{{ year }}</span>
                            <span class="font-medium text-gray-900">{{ count }} learners</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-3">
                            <div class="{% if year == 'Year 1' %}bg-green-400{% elif year == 'Year 2' %}bg-blue-400{% else %}bg-purple-400{% endif %} h-3 rounded-full transition-all duration-500" style="width: {% widthratio count projects_data.total_students 100 %}%"></div>
                        </div>
                    </div>
                    {% endfor %}
                    {% else %}
                    <div class="text-center py-8">
                        <p class="text-sm text-gray-500">No progress data available</p>
                    </div>
                    {% endif %}
                </div>
            </div>
            
            <!-- Competency Breakdown -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                <h3 class="text-lg font-semibold text-gray-900 mb-6">Competency Overview</h3>
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-green-50 rounded-lg p-4 text-center">
                        <p class="text-3xl font-bold text-green-600">{{ projects_data.competency_rates.competent|default:"0" }}</p>
                        <p class="text-sm text-green-700 mt-1">Competent</p>
                    </div>
                    <div class="bg-yellow-50 rounded-lg p-4 text-center">
                        <p class="text-3xl font-bold text-yellow-600">{{ projects_data.competency_rates.in_progress|default:"0" }}</p>
                        <p class="text-sm text-yellow-700 mt-1">In Progress</p>
                    </div>
                    <div class="bg-red-50 rounded-lg p-4 text-center">
                        <p class="text-3xl font-bold text-red-600">{{ projects_data.competency_rates.not_competent|default:"0" }}</p>
                        <p class="text-sm text-red-700 mt-1">Not Yet Competent</p>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-4 text-center">
                        <p class="text-3xl font-bold text-gray-600">{{ projects_data.competency_rates.not_assessed|default:"0" }}</p>
                        <p class="text-sm text-gray-700 mt-1">Not Assessed</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Projects Filter Bar -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-4">
            <form method="get" class="flex flex-wrap items-center gap-4">
                <input type="hidden" name="view" value="projects">
                {% if request.GET.campus %}
                <input type="hidden" name="campus" value="{{ request.GET.campus }}">
                {% endif %}
                
                <div class="flex-1 min-w-[200px]">
                    <label class="block text-xs font-medium text-gray-500 mb-1">Project Status</label>
                    <select name="project_status" class="w-full rounded-md border-gray-300 shadow-sm text-sm focus:ring-primary-500 focus:border-primary-500">
                        <option value="">All Statuses</option>
                        <option value="ACTIVE" {% if request.GET.project_status == 'ACTIVE' %}selected{% endif %}>Active</option>
                        <option value="PLANNING" {% if request.GET.project_status == 'PLANNING' %}selected{% endif %}>Planning</option>
                        <option value="IN_PROGRESS" {% if request.GET.project_status == 'IN_PROGRESS' %}selected{% endif %}>In Progress</option>
                        <option value="COMPLETED" {% if request.GET.project_status == 'COMPLETED' %}selected{% endif %}>Completed</option>
                    </select>
                </div>
                
                <div class="flex-1 min-w-[200px]">
                    <label class="block text-xs font-medium text-gray-500 mb-1">Funder/Client</label>
                    <select name="funder" class="w-full rounded-md border-gray-300 shadow-sm text-sm focus:ring-primary-500 focus:border-primary-500">
                        <option value="">All Funders</option>
                        {% for funder in projects_data.filters.funders %}
                        <option value="{{ funder.id }}" {% if request.GET.funder == funder.id|stringformat:"s" %}selected{% endif %}>{{ funder.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="flex-1 min-w-[150px]">
                    <label class="block text-xs font-medium text-gray-500 mb-1">Search</label>
                    <input type="text" name="project_search" value="{{ request.GET.project_search }}" placeholder="Search projects..." class="w-full rounded-md border-gray-300 shadow-sm text-sm focus:ring-primary-500 focus:border-primary-500">
                </div>
                
                <div class="flex items-end space-x-2">
                    <button type="submit" class="px-4 py-2 bg-primary-600 text-white text-sm font-medium rounded-md hover:bg-primary-700 transition">
                        <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"/>
                        </svg>
                        Filter
                    </button>
                    <a href="?view=projects{% if request.GET.campus %}&campus={{ request.GET.campus }}{% endif %}" class="px-4 py-2 bg-gray-100 text-gray-700 text-sm font-medium rounded-md hover:bg-gray-200 transition">
                        Clear
                    </a>
                </div>
            </form>
        </div>
        
        <!-- Projects Table -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-lg font-semibold text-gray-900">Active Projects</h3>
                <span class="text-sm text-gray-500">{{ projects_data.projects|length }} projects</span>
            </div>
            {% if projects_data.projects %}
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Project</th>
                            <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Total Learners</th>
                            <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">On Campus</th>
                            <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Workplace</th>
                            <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Progress</th>
                            <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Competency</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        {% for project in projects_data.projects %}
                        <tr class="hover:bg-gray-50 transition-colors">
                            <td class="px-4 py-4">
                                <div>
                                    <p class="font-medium text-gray-900">{{ project.name }}</p>
                                    <p class="text-xs text-gray-500">{{ project.funder }}</p>
                                </div>
                            </td>
                            <td class="px-4 py-4 text-center">
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                                    {{ project.total_learners }}
                                </span>
                            </td>
                            <td class="px-4 py-4 text-center">
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                    {{ project.on_campus }}
                                </span>
                            </td>
                            <td class="px-4 py-4 text-center">
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                    {{ project.in_workplace }}
                                </span>
                            </td>
                            <td class="px-4 py-4">
                                <div class="flex items-center">
                                    <div class="w-24 bg-gray-200 rounded-full h-2 mr-2">
                                        <div class="bg-primary-600 h-2 rounded-full" style="width: {{ project.avg_progress }}%"></div>
                                    </div>
                                    <span class="text-xs text-gray-600">{{ project.avg_progress }}%</span>
                                </div>
                            </td>
                            <td class="px-4 py-4 text-center">
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium {% if project.competency_rate >= 70 %}bg-green-100 text-green-800{% elif project.competency_rate >= 50 %}bg-yellow-100 text-yellow-800{% else %}bg-red-100 text-red-800{% endif %}">
                                    {{ project.competency_rate }}%
                                </span>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="text-center py-8">
                <svg class="w-12 h-12 text-gray-300 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                </svg>
                <p class="mt-2 text-sm text-gray-500">No active projects found</p>
            </div>
            {% endif %}
        </div>
    </div>
    
    <!-- ==================== IMPLEMENTATION VIEW (GANTT) ==================== -->
    {% elif current_view == 'implementation' %}
    <div class="space-y-6" x-data="implementationGantt()">
        <!-- Implementation Overview Header -->
        <div class="bg-gradient-to-r from-indigo-600 to-indigo-800 rounded-xl shadow-lg p-6 text-white">
            <div class="flex items-center justify-between">
                <div>
                    <h2 class="text-2xl font-bold">Implementation Plans</h2>
                    <p class="mt-1 text-indigo-100">Gantt view of project phases and delivery timelines</p>
                </div>
                <div class="flex space-x-8">
                    <div class="text-center">
                        <p class="text-3xl font-bold">{{ implementation_data.gantt_data|length }}</p>
                        <p class="text-sm text-indigo-100">Cohorts</p>
                    </div>
                    {% for col in implementation_data.kanban_columns %}
                    <div class="text-center">
                        <p class="text-3xl font-bold">{{ col.count }}</p>
                        <p class="text-sm text-indigo-100">{{ col.label }}</p>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        
        <!-- Filter Bar -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-4">
            <form method="get" class="flex flex-wrap items-center gap-4">
                <input type="hidden" name="view" value="implementation">
                {% if request.GET.campus %}
                <input type="hidden" name="campus" value="{{ request.GET.campus }}">
                {% endif %}
                
                <div class="flex-1 min-w-[200px]">
                    <label class="block text-xs font-medium text-gray-500 mb-1">Qualification</label>
                    <select name="qualification" class="w-full rounded-md border-gray-300 shadow-sm text-sm focus:ring-primary-500 focus:border-primary-500">
                        <option value="">All Qualifications</option>
                        {% for q in implementation_data.filters.qualifications %}
                        <option value="{{ q.id }}" {% if implementation_data.filters.selected_qualification == q.id|stringformat:"s" %}selected{% endif %}>{{ q.short_title }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="flex-1 min-w-[200px]">
                    <label class="block text-xs font-medium text-gray-500 mb-1">Project</label>
                    <select name="project" class="w-full rounded-md border-gray-300 shadow-sm text-sm focus:ring-primary-500 focus:border-primary-500">
                        <option value="">All Projects</option>
                        {% for p in implementation_data.filters.projects %}
                        <option value="{{ p.id }}" {% if implementation_data.filters.selected_project == p.id|stringformat:"s" %}selected{% endif %}>{{ p.title|default:p.reference_number }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="w-32">
                    <label class="block text-xs font-medium text-gray-500 mb-1">Year</label>
                    <select name="year" class="w-full rounded-md border-gray-300 shadow-sm text-sm focus:ring-primary-500 focus:border-primary-500">
                        <option value="">All Years</option>
                        {% for y in implementation_data.filters.years %}
                        <option value="{{ y }}" {% if implementation_data.filters.selected_year == y|stringformat:"s" %}selected{% endif %}>Year {{ y }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="flex items-end">
                    <button type="submit" class="px-4 py-2 bg-primary-600 text-white text-sm font-medium rounded-md hover:bg-primary-700 transition-colors">
                        Apply Filters
                    </button>
                </div>
            </form>
        </div>
        
        <!-- Phase Type Legend -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-4">
            <div class="flex flex-wrap items-center gap-4">
                <span class="text-sm font-medium text-gray-700">Phase Types:</span>
                <div class="flex items-center gap-2">
                    <span class="w-3 h-3 rounded-full bg-indigo-500"></span>
                    <span class="text-sm text-gray-600">Induction</span>
                </div>
                <div class="flex items-center gap-2">
                    <span class="w-3 h-3 rounded-full bg-blue-500"></span>
                    <span class="text-sm text-gray-600">Institutional</span>
                </div>
                <div class="flex items-center gap-2">
                    <span class="w-3 h-3 rounded-full bg-green-500"></span>
                    <span class="text-sm text-gray-600">Workplace</span>
                </div>
                <div class="flex items-center gap-2">
                    <span class="w-3 h-3 rounded-full bg-purple-500"></span>
                    <span class="text-sm text-gray-600">Integration</span>
                </div>
                <div class="flex items-center gap-2">
                    <span class="w-3 h-3 rounded-full bg-amber-500"></span>
                    <span class="text-sm text-gray-600">Trade Test</span>
                </div>
                <div class="flex items-center gap-2">
                    <span class="w-3 h-3 rounded-full bg-rose-500"></span>
                    <span class="text-sm text-gray-600">Assessment</span>
                </div>
                <div class="ml-auto flex items-center gap-4">
                    <div class="flex items-center gap-2">
                        <span class="w-3 h-3 rounded border-2 border-gray-400 bg-gray-100"></span>
                        <span class="text-sm text-gray-600">Pending</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="w-3 h-3 rounded bg-gradient-to-r from-blue-500 to-blue-600"></span>
                        <span class="text-sm text-gray-600">In Progress</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="w-3 h-3 rounded bg-gray-400"></span>
                        <span class="text-sm text-gray-600">Completed</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Gantt Chart -->
        {% if implementation_data.gantt_data %}
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
            <!-- Gantt Timeline Header -->
            <div class="flex border-b border-gray-200">
                <!-- Cohort Info Column Header -->
                <div class="w-72 flex-shrink-0 px-4 py-3 bg-gray-50 border-r border-gray-200">
                    <span class="text-sm font-semibold text-gray-700">Cohort / Project</span>
                </div>
                <!-- Timeline Header -->
                <div class="flex-1 relative bg-gray-50">
                    <div class="relative h-10">
                        {% for marker in implementation_data.gantt_timeline.month_markers %}
                        <div class="absolute top-0 bottom-0 border-l border-gray-200 text-xs text-gray-500 pl-1 pt-2"
                             style="left: {{ marker.offset }}%;">
                            <span class="font-medium">{{ marker.month }}</span>
                            {% if marker.month == 'Jan' %}
                            <span class="text-gray-400">{{ marker.year }}</span>
                            {% endif %}
                        </div>
                        {% endfor %}
                        <!-- Today marker -->
                        <div class="absolute top-0 bottom-0 w-0.5 bg-red-500 z-10"
                             style="left: {{ implementation_data.gantt_timeline.today_offset }}%;"
                             title="Today">
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Gantt Rows -->
            <div class="divide-y divide-gray-100 max-h-[600px] overflow-y-auto">
                {% for cohort in implementation_data.gantt_data %}
                <div class="flex hover:bg-gray-50 transition-colors group">
                    <!-- Cohort Info -->
                    <div class="w-72 flex-shrink-0 px-4 py-3 border-r border-gray-100">
                        <div class="flex items-center justify-between">
                            <div class="min-w-0 flex-1">
                                <p class="text-sm font-semibold text-gray-900 truncate">{{ cohort.cohort_code }}</p>
                                <p class="text-xs text-gray-500 truncate">{{ cohort.project_name }}</p>
                                <p class="text-xs text-gray-400 truncate">{{ cohort.qualification }}</p>
                            </div>
                            <div class="flex-shrink-0 ml-2 text-right">
                                <span class="text-xs font-medium text-gray-500">{{ cohort.completed_phases }}/{{ cohort.total_phases }}</span>
                                <div class="w-12 bg-gray-200 rounded-full h-1.5 mt-1">
                                    <div class="bg-green-500 h-1.5 rounded-full" style="width: {% widthratio cohort.completed_phases cohort.total_phases 100 %}%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Timeline / Gantt Bars -->
                    <div class="flex-1 relative py-2 min-h-[60px]">
                        <!-- Month grid lines -->
                        {% for marker in implementation_data.gantt_timeline.month_markers %}
                        <div class="absolute top-0 bottom-0 border-l border-gray-100"
                             style="left: {{ marker.offset }}%;"></div>
                        {% endfor %}
                        
                        <!-- Today marker line -->
                        <div class="absolute top-0 bottom-0 w-0.5 bg-red-500/30 z-0"
                             style="left: {{ implementation_data.gantt_timeline.today_offset }}%;"></div>
                        
                        <!-- Phase bars -->
                        {% for phase in cohort.phases %}
                        <div class="absolute top-1/2 -translate-y-1/2 h-8 rounded cursor-pointer transition-all duration-200 hover:scale-y-110 hover:z-20 group/phase
                                    {% if phase.status == 'COMPLETED' %}bg-gray-400{% elif phase.status == 'IN_PROGRESS' %}bg-{{ phase.color }}-500 ring-2 ring-{{ phase.color }}-300{% else %}bg-{{ phase.color }}-300 border border-{{ phase.color }}-400{% endif %}"
                             style="left: {{ phase.start_offset }}%; width: {{ phase.bar_width }}%; min-width: 4px;"
                             @click="openPhaseDetail({{ phase.id }})"
                             x-data
                             title="{{ phase.name }} ({{ phase.duration_weeks }} weeks)">
                            <!-- Phase label (only show if bar is wide enough) -->
                            {% if phase.bar_width > 5 %}
                            <div class="absolute inset-0 flex items-center px-2 overflow-hidden">
                                <span class="text-xs font-medium text-white truncate drop-shadow-sm">
                                    {{ phase.name|truncatechars:20 }}
                                </span>
                            </div>
                            {% endif %}
                            
                            <!-- Tooltip on hover -->
                            <div class="absolute bottom-full left-0 mb-2 hidden group-hover/phase:block z-30">
                                <div class="bg-gray-900 text-white text-xs rounded-lg px-3 py-2 shadow-lg whitespace-nowrap">
                                    <p class="font-semibold">{{ phase.name }}</p>
                                    <p class="text-gray-300">{{ phase.phase_type_display }} â€¢ {{ phase.duration_weeks }} weeks</p>
                                    {% if phase.planned_start and phase.planned_end %}
                                    <p class="text-gray-300">{{ phase.planned_start|date:"d M Y" }} - {{ phase.planned_end|date:"d M Y" }}</p>
                                    {% endif %}
                                    <p class="text-gray-300">Status: {{ phase.status }}</p>
                                    <p class="text-gray-300">Progress: {{ phase.progress }}%</p>
                                </div>
                            </div>
                            
                            <!-- Progress indicator for in-progress phases -->
                            {% if phase.status == 'IN_PROGRESS' and phase.progress > 0 %}
                            <div class="absolute inset-y-0 left-0 bg-{{ phase.color }}-600 rounded-l opacity-75"
                                 style="width: {{ phase.progress }}%;"></div>
                            {% endif %}
                            
                            <!-- Status indicators -->
                            {% if phase.is_overdue %}
                            <div class="absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full border-2 border-white" title="Overdue"></div>
                            {% elif phase.is_at_risk %}
                            <div class="absolute -top-1 -right-1 w-3 h-3 bg-amber-500 rounded-full border-2 border-white" title="At Risk"></div>
                            {% endif %}
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% else %}
        <!-- Empty State -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-12 text-center">
            <svg class="w-16 h-16 text-gray-300 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17V7m0 10a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h2a2 2 0 012 2m0 10a2 2 0 002 2h2a2 2 0 002-2M9 7a2 2 0 012-2h2a2 2 0 012 2m0 10V7m0 10a2 2 0 002 2h2a2 2 0 002-2V7a2 2 0 00-2-2h-2a2 2 0 00-2 2"/>
            </svg>
            <h3 class="text-lg font-medium text-gray-900 mb-2">No Implementation Plans Found</h3>
            <p class="text-gray-500 mb-4">Create implementation plan templates for your qualifications to get started.</p>
            <a href="{% url 'academics:qualification_list' %}" class="inline-flex items-center px-4 py-2 bg-primary-600 text-white text-sm font-medium rounded-md hover:bg-primary-700 transition-colors">
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                </svg>
                Manage Qualifications
            </a>
        </div>
        {% endif %}
        
        <!-- Missing Implementation Plans Alert -->
        {% if implementation_data.missing_plans %}
        <div class="bg-amber-50 border border-amber-200 rounded-xl p-6">
            <div class="flex items-start">
                <div class="flex-shrink-0">
                    <svg class="w-6 h-6 text-amber-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                    </svg>
                </div>
                <div class="ml-4 flex-1">
                    <h3 class="text-sm font-medium text-amber-800">{{ implementation_data.missing_plans_count }} Cohort{{ implementation_data.missing_plans_count|pluralize }} Without Implementation Plans</h3>
                    <p class="mt-1 text-sm text-amber-700">The following cohorts don't have implementation plans assigned. Link them to a project with a cohort to auto-create, or create a template first.</p>
                    <div class="mt-4 space-y-2">
                        {% for mp in implementation_data.missing_plans %}
                        <div class="flex items-center justify-between bg-white rounded-lg px-4 py-2 border border-amber-200">
                            <div>
                                <p class="text-sm font-medium text-gray-900">{{ mp.cohort_code }} - {{ mp.cohort_name }}</p>
                                <p class="text-xs text-gray-500">{{ mp.qualification }} â€¢ {{ mp.project_name }}</p>
                            </div>
                            {% if mp.has_template %}
                            <span class="px-2 py-1 text-xs font-medium bg-green-100 text-green-800 rounded">Template Available</span>
                            {% else %}
                            <a href="{% url 'academics:implementation_plan_create' mp.qualification_id %}" class="px-3 py-1 text-xs font-medium bg-amber-100 text-amber-800 rounded hover:bg-amber-200 transition-colors">
                                Create Template
                            </a>
                            {% endif %}
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
        
        <!-- Phase Detail Slide-Over -->
        <div x-show="slideOverOpen" 
             x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0"
             x-transition:enter-end="opacity-100"
             x-transition:leave="transition ease-in duration-200"
             x-transition:leave-start="opacity-100"
             x-transition:leave-end="opacity-0"
             class="fixed inset-0 z-50 overflow-hidden"
             @keydown.escape.window="slideOverOpen = false">
            <!-- Backdrop -->
            <div class="absolute inset-0 bg-gray-500 bg-opacity-75" @click="slideOverOpen = false"></div>
            
            <!-- Panel -->
            <div class="absolute inset-y-0 right-0 max-w-lg w-full">
                <div x-show="slideOverOpen"
                     x-transition:enter="transform transition ease-out duration-300"
                     x-transition:enter-start="translate-x-full"
                     x-transition:enter-end="translate-x-0"
                     x-transition:leave="transform transition ease-in duration-200"
                     x-transition:leave-start="translate-x-0"
                     x-transition:leave-end="translate-x-full"
                     class="h-full bg-white shadow-xl overflow-y-auto">
                    <!-- Panel Header -->
                    <div class="sticky top-0 bg-white border-b border-gray-200 px-6 py-4 z-10">
                        <div class="flex items-center justify-between">
                            <h2 class="text-lg font-semibold text-gray-900" x-text="selectedPhase ? selectedPhase.name : 'Phase Details'"></h2>
                            <button @click="slideOverOpen = false" class="text-gray-400 hover:text-gray-600">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Panel Content -->
                    <div class="px-6 py-4 space-y-6">
                        <template x-if="selectedPhase">
                            <div>
                                <!-- Phase Header Info -->
                                <div class="bg-gray-50 rounded-lg p-4 mb-6">
                                    <div class="flex items-center space-x-3 mb-3">
                                        <span class="w-4 h-4 rounded-full" :class="'bg-' + selectedPhase.color + '-500'"></span>
                                        <span class="text-sm font-medium text-gray-700" x-text="selectedPhase.phase_type_display"></span>
                                    </div>
                                    <p class="text-sm text-gray-600"><span class="font-medium">Project:</span> <span x-text="selectedPhase.project_name"></span></p>
                                    <p class="text-sm text-gray-600"><span class="font-medium">Cohort:</span> <span x-text="selectedPhase.cohort_code + ' - ' + selectedPhase.cohort_name"></span></p>
                                    <p class="text-sm text-gray-600"><span class="font-medium">Qualification:</span> <span x-text="selectedPhase.qualification"></span></p>
                                </div>
                                
                                <!-- Status Update -->
                                <div class="mb-6">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Status</label>
                                    <select x-model="selectedPhase.status" @change="updatePhaseStatus()" class="w-full rounded-md border-gray-300 shadow-sm text-sm focus:ring-primary-500 focus:border-primary-500">
                                        <option value="PENDING">Pending</option>
                                        <option value="PLANNED">Planned</option>
                                        <option value="IN_PROGRESS">In Progress</option>
                                        <option value="COMPLETED">Completed</option>
                                        <option value="DELAYED">Delayed</option>
                                    </select>
                                </div>
                                
                                <!-- Duration -->
                                <div class="mb-6">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Duration</label>
                                    <p class="text-sm text-gray-600" x-text="selectedPhase.duration_weeks + ' weeks'"></p>
                                </div>
                                
                                <!-- Dates -->
                                <div class="grid grid-cols-2 gap-4 mb-6">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Planned Start</label>
                                        <p class="text-sm text-gray-600" x-text="selectedPhase.planned_start || 'Not set'"></p>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Planned End</label>
                                        <p class="text-sm text-gray-600" x-text="selectedPhase.planned_end || 'Not set'"></p>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Actual Start</label>
                                        <p class="text-sm text-gray-600" x-text="selectedPhase.actual_start || 'Not started'"></p>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Actual End</label>
                                        <p class="text-sm text-gray-600" x-text="selectedPhase.actual_end || 'Not completed'"></p>
                                    </div>
                                </div>
                                
                                <!-- Progress -->
                                <div class="mb-6">
                                    <div class="flex items-center justify-between mb-2">
                                        <label class="text-sm font-medium text-gray-700">Module Progress</label>
                                        <span class="text-sm font-semibold" x-text="selectedPhase.progress + '%'"></span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-3">
                                        <div class="h-3 rounded-full transition-all duration-300" 
                                             :class="'bg-' + selectedPhase.color + '-500'"
                                             :style="'width: ' + selectedPhase.progress + '%'"></div>
                                    </div>
                                    <p class="text-xs text-gray-500 mt-1" x-text="selectedPhase.module_count + ' module(s) in this phase'"></p>
                                </div>
                                
                                <!-- Variance Info -->
                                <div x-show="selectedPhase.days_variance !== 0" class="bg-amber-50 border border-amber-200 rounded-lg p-4 mb-6">
                                    <p class="text-sm text-amber-800">
                                        <span class="font-medium">Schedule Variance:</span>
                                        <span x-text="selectedPhase.days_variance > 0 ? selectedPhase.days_variance + ' days behind' : Math.abs(selectedPhase.days_variance) + ' days ahead'"></span>
                                    </p>
                                </div>
                            </div>
                        </template>
                        
                        <template x-if="!selectedPhase && loading">
                            <div class="text-center py-8 text-gray-400">
                                <svg class="animate-spin h-8 w-8 mx-auto mb-2 text-primary-600" fill="none" viewBox="0 0 24 24">
                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                </svg>
                                <p>Loading phase details...</p>
                            </div>
                        </template>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
    function implementationGantt() {
        return {
            slideOverOpen: false,
            selectedPhase: null,
            loading: false,
            ganttData: {{ implementation_data.gantt_data|safe }},
            
            openPhaseDetail(phaseId) {
                this.loading = true;
                this.slideOverOpen = true;
                
                // Find the phase from gantt data
                for (const cohort of this.ganttData) {
                    const phase = cohort.phases.find(p => p.id === phaseId);
                    if (phase) {
                        this.selectedPhase = {
                            ...phase,
                            cohort_code: cohort.cohort_code,
                            cohort_name: cohort.cohort_name,
                            qualification: cohort.qualification,
                            project_name: cohort.project_name
                        };
                        break;
                    }
                }
                this.loading = false;
            },
            
            async updatePhaseStatus() {
                if (!this.selectedPhase) return;
                
                try {
                    const response = await fetch('{% url "core:implementation_phase_update" %}', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': '{{ csrf_token }}'
                        },
                        body: JSON.stringify({
                            phase_id: this.selectedPhase.id,
                            status: this.selectedPhase.status
                        })
                    });
                    
                    if (response.ok) {
                        location.reload();
                    }
                } catch (error) {
                    console.error('Error updating phase status:', error);
                }
            }
        }
    }
    </script>
    
    <!-- ==================== DEFAULT OVERVIEW VIEW ==================== -->
    {% else %}
    
    <!-- KPI Cards Row -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <!-- Total Learners -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 hover:shadow-md transition-all duration-300">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-gray-500 uppercase tracking-wider">Total Learners</p>
                    <p class="mt-2 text-3xl font-bold text-gray-900">{{ kpis.total_learners|default:"0" }}</p>
                    <p class="mt-1 text-sm text-gray-600">
                        <span class="text-green-500 font-medium">+{{ kpis.new_learners_month|default:"0" }}</span> this month
                    </p>
                </div>
                <div class="p-4 bg-primary-100 rounded-full">
                    <svg class="w-8 h-8 text-primary-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/>
                    </svg>
                </div>
            </div>
            <div class="mt-4">
                <div class="flex items-center text-xs text-gray-500">
                    <span class="inline-block w-3 h-3 rounded-full bg-green-400 mr-2"></span>
                    {{ kpis.active_learners|default:"0" }} Active
                </div>
            </div>
        </div>
        
        <!-- Active Enrollments -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 hover:shadow-md transition-all duration-300">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-gray-500 uppercase tracking-wider">Active Enrollments</p>
                    <p class="mt-2 text-3xl font-bold text-gray-900">{{ kpis.active_enrollments|default:"0" }}</p>
                    <p class="mt-1 text-sm text-gray-600">
                        <span class="text-primary-600 font-medium">{{ kpis.total_enrollments|default:"0" }}</span> total
                    </p>
                </div>
                <div class="p-4 bg-blue-100 rounded-full">
                    <svg class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                    </svg>
                </div>
            </div>
            <div class="mt-4">
                <div class="w-full bg-gray-200 rounded-full h-2">
                    <div class="bg-blue-600 h-2 rounded-full transition-all duration-500" style="width: {% widthratio kpis.active_enrollments kpis.total_enrollments 100 %}%"></div>
                </div>
            </div>
        </div>
        
        <!-- Corporate Contracts -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 hover:shadow-md transition-all duration-300">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-gray-500 uppercase tracking-wider">Corporate Clients</p>
                    <p class="mt-2 text-3xl font-bold text-gray-900">{{ corporate_stats.active_clients|default:"0" }}</p>
                    <p class="mt-1 text-sm text-gray-600">
                        <span class="text-orange-500 font-medium">{{ corporate_stats.prospects|default:"0" }}</span> prospects
                    </p>
                </div>
                <div class="p-4 bg-orange-100 rounded-full">
                    <svg class="w-8 h-8 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                    </svg>
                </div>
            </div>
            <div class="mt-4">
                <div class="flex items-center text-xs text-gray-500">
                    <span class="inline-block w-3 h-3 rounded-full bg-orange-400 mr-2"></span>
                    {{ corporate_stats.total_clients|default:"0" }} Total Clients
                </div>
            </div>
        </div>
        
        <!-- Completion Rate -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 hover:shadow-md transition-all duration-300">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-gray-500 uppercase tracking-wider">Completion Rate</p>
                    <p class="mt-2 text-3xl font-bold text-gray-900">{{ kpis.completion_rate|default:"0" }}%</p>
                    <p class="mt-1 text-sm text-gray-600">
                        <span class="text-green-500 font-medium">{{ kpis.completed_enrollments|default:"0" }}</span> completed
                    </p>
                </div>
                <div class="p-4 bg-green-100 rounded-full">
                    <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"/>
                    </svg>
                </div>
            </div>
            <div class="mt-4">
                <div class="w-full bg-gray-200 rounded-full h-2">
                    <div class="bg-green-600 h-2 rounded-full transition-all duration-500" style="width: {{ kpis.completion_rate|default:0 }}%"></div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Charts Row -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Enrollment Trend Chart -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-lg font-semibold text-gray-900">Enrollment Trends</h3>
                <div class="flex space-x-2">
                    <span class="inline-flex items-center text-xs">
                        <span class="w-3 h-3 bg-primary-500 rounded-full mr-1"></span>
                        Enrollments
                    </span>
                    <span class="inline-flex items-center text-xs">
                        <span class="w-3 h-3 bg-green-500 rounded-full mr-1"></span>
                        Learners
                    </span>
                </div>
            </div>
            <div class="h-64" x-data="{ 
                months: {{ trends.months|safe }},
                enrollments: {{ trends.enrollment_trend|safe }},
                learners: {{ trends.learner_trend|safe }}
            }">
                <canvas id="enrollmentChart"></canvas>
            </div>
        </div>
        
        <!-- Training Progress Distribution -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-lg font-semibold text-gray-900">Training Progress</h3>
                <span class="text-sm text-gray-500">{{ training_progress.total_active }} active learners</span>
            </div>
            <div class="space-y-4">
                {% for label, count in training_progress.progress_ranges.items %}
                <div>
                    <div class="flex justify-between text-sm mb-1">
                        <span class="text-gray-600">{{ label }}</span>
                        <span class="font-medium text-gray-900">{{ count }} learners</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-3">
                        {% if training_progress.total_active > 0 %}
                        <div class="{% if label == '0-25%' %}bg-red-400{% elif label == '25-50%' %}bg-yellow-400{% elif label == '50-75%' %}bg-blue-400{% else %}bg-green-400{% endif %} h-3 rounded-full transition-all duration-500" style="width: {% widthratio count training_progress.total_active 100 %}%"></div>
                        {% else %}
                        <div class="bg-gray-300 h-3 rounded-full" style="width: 0%"></div>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
            <div class="mt-6 grid grid-cols-2 gap-4">
                <div class="bg-purple-50 rounded-lg p-4 text-center">
                    <p class="text-2xl font-bold text-purple-600">{{ training_progress.pending_assessments }}</p>
                    <p class="text-xs text-purple-700">Pending Assessments</p>
                </div>
                <div class="bg-blue-50 rounded-lg p-4 text-center">
                    <p class="text-2xl font-bold text-blue-600">{{ training_progress.due_this_month }}</p>
                    <p class="text-xs text-blue-700">Due This Month</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Financial & Resources Row -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Financial Overview -->
        <div class="lg:col-span-2 bg-white rounded-xl shadow-sm border border-gray-100 p-6">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-lg font-semibold text-gray-900">Financial Overview</h3>
                <a href="/admin/finance/" class="text-sm text-primary-600 hover:text-primary-700 font-medium">
                    View All â†’
                </a>
            </div>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="bg-gray-50 rounded-lg p-4">
                    <p class="text-xs text-gray-500 uppercase tracking-wider">Invoiced (YTD)</p>
                    <p class="mt-2 text-xl font-bold text-gray-900">R{{ financial.invoiced_ytd|floatformat:0|default:"0" }}</p>
                </div>
                <div class="bg-green-50 rounded-lg p-4">
                    <p class="text-xs text-gray-500 uppercase tracking-wider">Received (YTD)</p>
                    <p class="mt-2 text-xl font-bold text-green-600">R{{ financial.payments_ytd|floatformat:0|default:"0" }}</p>
                </div>
                <div class="bg-yellow-50 rounded-lg p-4">
                    <p class="text-xs text-gray-500 uppercase tracking-wider">Outstanding</p>
                    <p class="mt-2 text-xl font-bold text-yellow-600">R{{ financial.outstanding|floatformat:0|default:"0" }}</p>
                </div>
                <div class="bg-red-50 rounded-lg p-4">
                    <p class="text-xs text-gray-500 uppercase tracking-wider">Overdue</p>
                    <p class="mt-2 text-xl font-bold text-red-600">R{{ financial.overdue|floatformat:0|default:"0" }}</p>
                </div>
            </div>
            <div class="mt-6">
                <div class="flex justify-between text-sm mb-2">
                    <span class="text-gray-600">Collection Rate</span>
                    <span class="font-medium text-gray-900">{{ financial.collection_rate|default:"0" }}%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-3">
                    <div class="bg-gradient-to-r from-green-400 to-green-600 h-3 rounded-full transition-all duration-500" style="width: {{ financial.collection_rate|default:0 }}%"></div>
                </div>
            </div>
            <div class="mt-6 pt-4 border-t border-gray-100">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <p class="text-xs text-gray-500 uppercase tracking-wider">This Month Invoiced</p>
                        <p class="mt-1 text-lg font-semibold text-gray-900">R{{ financial.invoiced_mtd|floatformat:0|default:"0" }}</p>
                    </div>
                    <div>
                        <p class="text-xs text-gray-500 uppercase tracking-wider">This Month Received</p>
                        <p class="mt-1 text-lg font-semibold text-green-600">R{{ financial.payments_mtd|floatformat:0|default:"0" }}</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Resource Planning Preview -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-lg font-semibold text-gray-900">Resource Planning</h3>
                <a href="{% url 'core:resource_planning' %}" class="text-sm text-primary-600 hover:text-primary-700 font-medium">
                    Plan Resources â†’
                </a>
            </div>
            {% if resources.material_forecast %}
            <div class="space-y-3">
                {% for item in resources.material_forecast|slice:":5" %}
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                    <div>
                        <p class="font-medium text-gray-900 text-sm">{{ item.cohort }}</p>
                        <p class="text-xs text-gray-500">{{ item.qualification }}</p>
                    </div>
                    <div class="text-right">
                        <p class="font-semibold text-primary-600">{{ item.learner_count }}</p>
                        <p class="text-xs text-gray-400">{{ item.start_date|date:"d M" }}</p>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="text-center py-8">
                <svg class="w-12 h-12 text-gray-300 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"/>
                </svg>
                <p class="mt-2 text-sm text-gray-500">No upcoming cohorts</p>
            </div>
            {% endif %}
            <div class="mt-4 pt-4 border-t border-gray-100">
                <div class="flex items-center justify-between text-sm">
                    <span class="text-gray-600">Pending Material Orders</span>
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                        {{ resources.pending_orders }}
                    </span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Enrollments by Qualification & Upcoming Events -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Enrollments by Qualification -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-lg font-semibold text-gray-900">Enrollments by Qualification</h3>
            </div>
            {% if enrollment_stats.by_qualification %}
            <div class="overflow-hidden">
                <table class="min-w-full">
                    <thead>
                        <tr class="border-b border-gray-100">
                            <th class="text-left text-xs font-medium text-gray-500 uppercase tracking-wider py-2">Qualification</th>
                            <th class="text-center text-xs font-medium text-gray-500 uppercase tracking-wider py-2">NQF</th>
                            <th class="text-center text-xs font-medium text-gray-500 uppercase tracking-wider py-2">Active</th>
                            <th class="text-center text-xs font-medium text-gray-500 uppercase tracking-wider py-2">Completed</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-50">
                        {% for qual in enrollment_stats.by_qualification %}
                        <tr class="hover:bg-gray-50 transition-colors">
                            <td class="py-3 text-sm text-gray-900">{{ qual.qualification__short_title|default:"Unknown" }}</td>
                            <td class="py-3 text-sm text-gray-500 text-center">{{ qual.qualification__nqf_level|default:"-" }}</td>
                            <td class="py-3 text-center">
                                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                    {{ qual.active }}
                                </span>
                            </td>
                            <td class="py-3 text-center">
                                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                    {{ qual.completed }}
                                </span>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="text-center py-8">
                <svg class="w-12 h-12 text-gray-300 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                </svg>
                <p class="mt-2 text-sm text-gray-500">No enrollments yet</p>
            </div>
            {% endif %}
        </div>
        
        <!-- Upcoming Events -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-lg font-semibold text-gray-900">Upcoming Events</h3>
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-100 text-primary-800">
                    Next 30 Days
                </span>
            </div>
            {% if upcoming %}
            <div class="space-y-3">
                {% for event in upcoming %}
                <div class="flex items-start space-x-3 p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                    <div class="flex-shrink-0">
                        <div class="w-10 h-10 rounded-lg {% if event.color == 'blue' %}bg-blue-100 text-blue-600{% elif event.color == 'purple' %}bg-purple-100 text-purple-600{% elif event.color == 'green' %}bg-green-100 text-green-600{% else %}bg-gray-100 text-gray-600{% endif %} flex items-center justify-center">
                            {% if event.type == 'cohort' %}
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/>
                            </svg>
                            {% elif event.type == 'assessment' %}
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/>
                            </svg>
                            {% else %}
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                            </svg>
                            {% endif %}
                        </div>
                    </div>
                    <div class="flex-1 min-w-0">
                        <p class="text-sm font-medium text-gray-900 truncate">{{ event.title }}</p>
                        <p class="text-xs text-gray-500">{{ event.date|date:"D, d M Y" }}</p>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="text-center py-8">
                <svg class="w-12 h-12 text-gray-300 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                </svg>
                <p class="mt-2 text-sm text-gray-500">No upcoming events</p>
            </div>
            {% endif %}
        </div>
    </div>
    
    <!-- Quick Actions -->
    <div class="bg-gradient-to-r from-primary-600 to-primary-800 rounded-xl shadow-lg p-6">
        <h3 class="text-lg font-semibold text-white mb-4">Quick Actions</h3>
        <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-8 gap-4">
            <a href="{% url 'not_dashboard' %}" class="flex flex-col items-center p-4 bg-white/10 rounded-lg hover:bg-white/20 transition-colors group ring-2 ring-yellow-400">
                <div class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center mb-2 group-hover:bg-white/30 transition-colors">
                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/>
                    </svg>
                </div>
                <span class="text-sm text-white font-medium text-center">Training NOT</span>
            </a>
            <a href="{% url 'corporate:dashboard' %}" class="flex flex-col items-center p-4 bg-white/10 rounded-lg hover:bg-white/20 transition-colors group ring-2 ring-green-400">
                <div class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center mb-2 group-hover:bg-white/30 transition-colors">
                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                    </svg>
                </div>
                <span class="text-sm text-white font-medium text-center">Corporate Services</span>
            </a>
            <a href="{% url 'admin:enrollment_wizard' %}?step=1" class="flex flex-col items-center p-4 bg-white/10 rounded-lg hover:bg-white/20 transition-colors group">
                <div class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center mb-2 group-hover:bg-white/30 transition-colors">
                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"/>
                    </svg>
                </div>
                <span class="text-sm text-white font-medium text-center">Add Learner</span>
            </a>
            <a href="{% url 'admin:enrollment_wizard' %}?step=1" class="flex flex-col items-center p-4 bg-white/10 rounded-lg hover:bg-white/20 transition-colors group">
                <div class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center mb-2 group-hover:bg-white/30 transition-colors">
                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                    </svg>
                </div>
                <span class="text-sm text-white font-medium text-center">New Enrollment</span>
            </a>
            <a href="{% url 'corporate:client_create' %}" class="flex flex-col items-center p-4 bg-white/10 rounded-lg hover:bg-white/20 transition-colors group">
                <div class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center mb-2 group-hover:bg-white/30 transition-colors">
                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                    </svg>
                </div>
                <span class="text-sm text-white font-medium text-center">Add Company</span>
            </a>
            <a href="{% url 'admin:invoice_create' %}" class="flex flex-col items-center p-4 bg-white/10 rounded-lg hover:bg-white/20 transition-colors group">
                <div class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center mb-2 group-hover:bg-white/30 transition-colors">
                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                    </svg>
                </div>
                <span class="text-sm text-white font-medium text-center">Create Invoice</span>
            </a>
            <a href="/admin/assessments/" class="flex flex-col items-center p-4 bg-white/10 rounded-lg hover:bg-white/20 transition-colors group">
                <div class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center mb-2 group-hover:bg-white/30 transition-colors">
                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/>
                    </svg>
                </div>
                <span class="text-sm text-white font-medium text-center">Schedule Assessment</span>
            </a>
            <a href="/admin/" class="flex flex-col items-center p-4 bg-white/10 rounded-lg hover:bg-white/20 transition-colors group">
                <div class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center mb-2 group-hover:bg-white/30 transition-colors">
                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                    </svg>
                </div>
                <span class="text-sm text-white font-medium text-center">Admin Panel</span>
            </a>
        </div>
    </div>
    {% endif %}
</div>

{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% if current_view == 'capacity' %}
<script>
// Capacity data from server
const capacityData = {
    classroom: {
        total: {{ capacity.total_seats|default:0 }},
        occupied: {{ capacity.occupied_seats|default:0 }},
        available: {{ capacity.available_seats|default:0 }},
        utilization: {{ capacity.utilization|default:0 }}
    },
    facilitator: {
        total: 0,
        assigned: 0,
        available: 0,
        workload: 0
    },
    equipment: {
        total: 0,
        inUse: 0,
        available: 0,
        utilization: 0
    }
};

// Calculate facilitator totals from server data
{% for item in capacity.facilitator_capacity %}
capacityData.facilitator.total += {{ item.total_facilitators|default:0 }};
capacityData.facilitator.assigned += {{ item.assigned_cohorts|default:0 }};
capacityData.facilitator.available += {{ item.available_facilitators|default:0 }};
capacityData.facilitator.workload += {{ item.workload|default:0 }};
{% endfor %}
{% if capacity.facilitator_capacity %}
capacityData.facilitator.workload = Math.round(capacityData.facilitator.workload / {{ capacity.facilitator_capacity|length }});
{% endif %}

// Calculate equipment totals from server data
{% for item in capacity.equipment_capacity %}
capacityData.equipment.total += {{ item.total_equipment|default:0 }};
capacityData.equipment.inUse += {{ item.in_use|default:0 }};
capacityData.equipment.available += {{ item.available|default:0 }};
capacityData.equipment.utilization += {{ item.utilization|default:0 }};
{% endfor %}
{% if capacity.equipment_capacity %}
capacityData.equipment.utilization = Math.round(capacityData.equipment.utilization / {{ capacity.equipment_capacity|length }});
{% endif %}

console.log('Capacity Data Loaded:', capacityData);

function switchCapacityView(type) {
    console.log('Switching to:', type);
    
    // Update button styles
    document.querySelectorAll('.capacity-toggle-btn').forEach(btn => {
        btn.classList.remove('bg-primary-600', 'text-white', 'shadow-sm');
        btn.classList.add('text-gray-700', 'hover:bg-gray-100');
    });
    const activeBtn = document.getElementById('btn-' + type);
    if (activeBtn) {
        activeBtn.classList.remove('text-gray-700', 'hover:bg-gray-100');
        activeBtn.classList.add('bg-primary-600', 'text-white', 'shadow-sm');
    }
    
    // Update the KPI cards based on selected type
    const label1 = document.getElementById('kpi-label-1');
    const label2 = document.getElementById('kpi-label-2');
    const label3 = document.getElementById('kpi-label-3');
    const label4 = document.getElementById('kpi-label-4');
    const value1 = document.getElementById('kpi-value-1');
    const value2 = document.getElementById('kpi-value-2');
    const value3 = document.getElementById('kpi-value-3');
    const value4 = document.getElementById('kpi-value-4');
    const headerUtil = document.getElementById('header-utilization');
    
    console.log('Elements found:', {label1, label2, label3, label4, value1, value2, value3, value4});
    
    if (type === 'classroom') {
        label1.textContent = 'Total Seats';
        label2.textContent = 'Occupied';
        label3.textContent = 'Available';
        label4.textContent = 'Utilization';
        value1.textContent = capacityData.classroom.total;
        value2.textContent = capacityData.classroom.occupied;
        value3.textContent = capacityData.classroom.available;
        value4.textContent = capacityData.classroom.utilization + '%';
        if (headerUtil) headerUtil.textContent = capacityData.classroom.utilization + '%';
    } else if (type === 'facilitator') {
        label1.textContent = 'Total Facilitators';
        label2.textContent = 'Assigned Cohorts';
        label3.textContent = 'Available';
        label4.textContent = 'Avg Workload';
        value1.textContent = capacityData.facilitator.total;
        value2.textContent = capacityData.facilitator.assigned;
        value3.textContent = capacityData.facilitator.available;
        value4.textContent = capacityData.facilitator.workload + '%';
        if (headerUtil) headerUtil.textContent = capacityData.facilitator.workload + '%';
    } else if (type === 'equipment') {
        label1.textContent = 'Total Equipment';
        label2.textContent = 'In Use';
        label3.textContent = 'Available';
        label4.textContent = 'Utilization';
        value1.textContent = capacityData.equipment.total;
        value2.textContent = capacityData.equipment.inUse;
        value3.textContent = capacityData.equipment.available;
        value4.textContent = capacityData.equipment.utilization + '%';
        if (headerUtil) headerUtil.textContent = capacityData.equipment.utilization + '%';
    }
    
    console.log('Values updated for', type);
}
</script>
{% endif %}

<script>
document.addEventListener('DOMContentLoaded', function() {
    
    // Enrollment Trend Chart (for Overview view)
    const ctx = document.getElementById('enrollmentChart');
    if (ctx) {
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: {{ trends.months|safe|default:"[]" }},
                datasets: [
                    {
                        label: 'Enrollments',
                        data: {{ trends.enrollment_trend|safe|default:"[]" }},
                        borderColor: 'rgb(14, 116, 144)',
                        backgroundColor: 'rgba(14, 116, 144, 0.1)',
                        tension: 0.4,
                        fill: true,
                    },
                    {
                        label: 'New Learners',
                        data: {{ trends.learner_trend|safe|default:"[]" }},
                        borderColor: 'rgb(34, 197, 94)',
                        backgroundColor: 'rgba(34, 197, 94, 0.1)',
                        tension: 0.4,
                        fill: true,
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: {
                            color: 'rgba(0, 0, 0, 0.05)'
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        }
                    }
                }
            }
        });
    }
});
</script>
{% endblock %}

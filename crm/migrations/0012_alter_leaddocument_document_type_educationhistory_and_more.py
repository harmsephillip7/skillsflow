# Generated by Django 5.2.8 on 2026-02-16 12:07

import django.core.validators
import django.db.models.deletion
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('academics', '0017_add_campuses_to_personnel'),
        ('crm', '0011_contentpost_socialmetricssnapshot_webtrafficsnapshot'),
        ('intakes', '0004_alter_intakeenrollment_funding_type'),
        ('tenants', '0004_add_campus_capacity_fields'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.AlterField(
            model_name='leaddocument',
            name='document_type',
            field=models.CharField(choices=[('ID_COPY', 'ID Copy / Passport'), ('MATRIC', 'Matric Certificate'), ('PROOF_ADDRESS', 'Proof of Address'), ('QUALIFICATION', 'Prior Qualification'), ('CV', 'Curriculum Vitae'), ('BANK_CONFIRM', 'Bank Confirmation'), ('PARENT_ID', 'Parent/Guardian ID'), ('PARENT_CONSENT', 'Parent/Guardian Consent'), ('PROOF_OF_PAYMENT', 'Proof of Payment'), ('OTHER', 'Other Document')], max_length=30),
        ),
        migrations.CreateModel(
            name='EducationHistory',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_deleted', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('institution_type', models.CharField(choices=[('PRIMARY', 'Primary School'), ('HIGH_SCHOOL', 'High School'), ('COLLEGE', 'College'), ('UNIVERSITY', 'University'), ('TVET', 'TVET College'), ('OTHER', 'Other')], max_length=20)),
                ('institution_name', models.CharField(max_length=200)),
                ('year_started', models.PositiveIntegerField(blank=True, null=True)),
                ('year_completed', models.PositiveIntegerField(blank=True, null=True)),
                ('is_current', models.BooleanField(default=False)),
                ('qualification_obtained', models.CharField(blank=True, help_text='e.g., Matric, N6, Diploma', max_length=200)),
                ('nqf_level', models.CharField(blank=True, help_text='NQF Level achieved', max_length=5)),
                ('notes', models.TextField(blank=True)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(class)s_created', to=settings.AUTH_USER_MODEL)),
                ('deleted_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_deleted', to=settings.AUTH_USER_MODEL)),
                ('lead', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='education_history', to='crm.lead')),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(class)s_updated', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Education History',
                'verbose_name_plural': 'Education Histories',
                'ordering': ['-year_completed', '-year_started'],
            },
        ),
        migrations.CreateModel(
            name='SalesEnrollmentRecord',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_deleted', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('is_primary_agent', models.BooleanField(default=True, help_text='Primary agent receives full commission')),
                ('enrollment_date', models.DateField()),
                ('month_period', models.CharField(help_text='YYYY-MM format for reporting', max_length=7)),
                ('funding_type', models.CharField(choices=[('PRIVATE_UPFRONT', 'Private - Upfront Payment'), ('PRIVATE_PMT_AGREEMENT', 'Private - Payment Agreement'), ('GOVERNMENT_BURSARY', 'Government Bursary'), ('CORPORATE_BURSARY', 'Corporate Bursary'), ('DG_BURSARY', 'DG Bursary')], max_length=25)),
                ('documents_uploaded_complete', models.BooleanField(default=False, help_text='All required documents uploaded')),
                ('documents_quality_approved', models.BooleanField(default=False, help_text='All documents passed quality check')),
                ('proof_of_payment_received', models.BooleanField(default=False, help_text='Any proof of payment uploaded')),
                ('compliance_issues', models.JSONField(blank=True, default=list, help_text="List of compliance issues: [{type: 'MISSING_DOC', doc_type: 'ID_COPY'}]")),
                ('last_compliance_check', models.DateTimeField(blank=True, null=True)),
                ('campus', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='sales_enrollment_records', to='tenants.campus')),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(class)s_created', to=settings.AUTH_USER_MODEL)),
                ('deleted_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_deleted', to=settings.AUTH_USER_MODEL)),
                ('enrollment', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='sales_records', to='intakes.intakeenrollment')),
                ('sales_person', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='sales_enrollment_records', to=settings.AUTH_USER_MODEL)),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(class)s_updated', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Sales Enrollment Record',
                'verbose_name_plural': 'Sales Enrollment Records',
                'ordering': ['-enrollment_date', 'sales_person'],
            },
        ),
        migrations.CreateModel(
            name='ComplianceAlert',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_deleted', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('alert_type', models.CharField(choices=[('MISSING_DOCUMENTS', 'Missing Documents'), ('QUALITY_REJECTED', 'Document Quality Rejected')], max_length=30)),
                ('details', models.JSONField(default=list, help_text="List of issues: [{doc_type: 'ID_COPY', issue: 'Missing'}]")),
                ('resolved', models.BooleanField(default=False)),
                ('resolved_date', models.DateTimeField(blank=True, null=True)),
                ('resolution_notes', models.TextField(blank=True)),
                ('campus', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='compliance_alerts', to='tenants.campus')),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(class)s_created', to=settings.AUTH_USER_MODEL)),
                ('deleted_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_deleted', to=settings.AUTH_USER_MODEL)),
                ('resolved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='resolved_alerts', to=settings.AUTH_USER_MODEL)),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(class)s_updated', to=settings.AUTH_USER_MODEL)),
                ('enrollment_record', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='compliance_alerts', to='crm.salesenrollmentrecord')),
            ],
            options={
                'verbose_name': 'Compliance Alert',
                'verbose_name_plural': 'Compliance Alerts',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='SecondaryContact',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_deleted', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('name', models.CharField(max_length=200)),
                ('relationship', models.CharField(choices=[('FATHER', 'Father'), ('MOTHER', 'Mother'), ('SPOUSE', 'Spouse'), ('EMPLOYER', 'Employer'), ('GIRLFRIEND', 'Girlfriend'), ('BOYFRIEND', 'Boyfriend'), ('GUARDIAN', 'Guardian'), ('SIBLING', 'Sibling'), ('OTHER', 'Other')], max_length=20)),
                ('phone', models.CharField(blank=True, max_length=20)),
                ('email', models.EmailField(blank=True, max_length=254)),
                ('company_name', models.CharField(blank=True, help_text='For employer contacts', max_length=200)),
                ('job_title', models.CharField(blank=True, help_text="Contact's job title", max_length=100)),
                ('notes', models.TextField(blank=True)),
                ('is_primary', models.BooleanField(default=False, help_text='Primary contact for this relationship type')),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(class)s_created', to=settings.AUTH_USER_MODEL)),
                ('deleted_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_deleted', to=settings.AUTH_USER_MODEL)),
                ('lead', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='secondary_contacts', to='crm.lead')),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(class)s_updated', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Secondary Contact',
                'verbose_name_plural': 'Secondary Contacts',
                'ordering': ['-is_primary', 'relationship', 'name'],
            },
        ),
        migrations.CreateModel(
            name='SubjectGrade',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_deleted', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('subject_type', models.CharField(choices=[('MATHEMATICS', 'Mathematics'), ('MATH_LITERACY', 'Mathematical Literacy'), ('ENGLISH', 'English'), ('AFRIKAANS', 'Afrikaans'), ('PHYSICAL_SCIENCE', 'Physical Science'), ('LIFE_SCIENCE', 'Life Science'), ('ACCOUNTING', 'Accounting'), ('BUSINESS_STUDIES', 'Business Studies'), ('ECONOMICS', 'Economics'), ('GEOGRAPHY', 'Geography'), ('HISTORY', 'History'), ('LIFE_ORIENTATION', 'Life Orientation'), ('CAT', 'Computer Applications Technology'), ('IT', 'Information Technology'), ('OTHER', 'Other')], max_length=30)),
                ('subject_name', models.CharField(blank=True, help_text='Custom subject name if OTHER', max_length=100)),
                ('mark_percentage', models.PositiveIntegerField(blank=True, help_text='Percentage achieved (0-100)', null=True, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)])),
                ('level', models.CharField(blank=True, help_text='Level achieved (1-7) or grade symbol', max_length=10)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(class)s_created', to=settings.AUTH_USER_MODEL)),
                ('deleted_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_deleted', to=settings.AUTH_USER_MODEL)),
                ('education', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='subjects', to='crm.educationhistory')),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(class)s_updated', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Subject Grade',
                'verbose_name_plural': 'Subject Grades',
                'ordering': ['subject_type'],
            },
        ),
        migrations.CreateModel(
            name='LeadInterest',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_deleted', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('interest_type', models.CharField(choices=[('PRIMARY', 'Primary Interest'), ('SECONDARY', 'Secondary Interest'), ('OTHER', 'Other Interest')], default='PRIMARY', max_length=20)),
                ('programme_type', models.CharField(choices=[('QUALIFICATION', 'Full Qualification'), ('SKILLS_PROGRAMME', 'Skills Programme'), ('LEARNERSHIP', 'Learnership'), ('ARPL', 'ARPL (Recognition of Prior Learning)'), ('SHORT_COURSE', 'Short Course')], default='QUALIFICATION', max_length=20)),
                ('notes', models.TextField(blank=True)),
                ('is_active', models.BooleanField(default=True)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(class)s_created', to=settings.AUTH_USER_MODEL)),
                ('deleted_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_deleted', to=settings.AUTH_USER_MODEL)),
                ('lead', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='interests', to='crm.lead')),
                ('qualification', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='lead_interests', to='academics.qualification')),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(class)s_updated', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Lead Interest',
                'verbose_name_plural': 'Lead Interests',
                'ordering': ['interest_type', 'created_at'],
                'unique_together': {('lead', 'qualification')},
            },
        ),
        migrations.CreateModel(
            name='LeadSalesAssignment',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_deleted', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('is_primary', models.BooleanField(default=False, help_text='Primary sales person receives commission')),
                ('assigned_date', models.DateTimeField(auto_now_add=True)),
                ('notes', models.TextField(blank=True)),
                ('is_active', models.BooleanField(default=True)),
                ('assigned_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='sales_assignments_made', to=settings.AUTH_USER_MODEL)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(class)s_created', to=settings.AUTH_USER_MODEL)),
                ('deleted_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_deleted', to=settings.AUTH_USER_MODEL)),
                ('lead', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='sales_assignments', to='crm.lead')),
                ('sales_person', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='lead_assignments', to=settings.AUTH_USER_MODEL)),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(class)s_updated', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Lead Sales Assignment',
                'verbose_name_plural': 'Lead Sales Assignments',
                'ordering': ['-is_primary', '-assigned_date'],
                'unique_together': {('lead', 'sales_person')},
            },
        ),
        migrations.AddIndex(
            model_name='salesenrollmentrecord',
            index=models.Index(fields=['month_period', 'sales_person'], name='crm_salesen_month_p_8b23cc_idx'),
        ),
        migrations.AddIndex(
            model_name='salesenrollmentrecord',
            index=models.Index(fields=['campus', 'month_period'], name='crm_salesen_campus__e5a3e6_idx'),
        ),
        migrations.AddIndex(
            model_name='compliancealert',
            index=models.Index(fields=['campus', 'resolved'], name='crm_complia_campus__7656b1_idx'),
        ),
        migrations.AddIndex(
            model_name='compliancealert',
            index=models.Index(fields=['alert_type', 'resolved'], name='crm_complia_alert_t_24b361_idx'),
        ),
    ]

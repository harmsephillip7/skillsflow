# Generated by Django 5.2.8 on 2026-01-11 19:30

import django.core.validators
import django.db.models.deletion
from decimal import Decimal
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('academics', '0009_alter_implementationmoduleslot_options_and_more'),
        ('core', '0019_course_pricing_system'),
        ('corporate', '0019_digital_signature'),
        ('finance', '0004_alter_bursaryprovider_provider_type'),
        ('tenants', '0002_extend_campus_code_length'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='CoursePricing',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_deleted', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('version', models.PositiveIntegerField(default=1)),
                ('version_notes', models.TextField(blank=True, help_text='Notes about this version (e.g., "2026 annual increase")')),
                ('status', models.CharField(choices=[('DRAFT', 'Draft'), ('PENDING_APPROVAL', 'Pending Approval'), ('APPROVED', 'Approved'), ('ACTIVE', 'Active'), ('SUPERSEDED', 'Superseded'), ('ARCHIVED', 'Archived')], default='DRAFT', max_length=20)),
                ('effective_from', models.DateField(help_text='Date this pricing becomes effective')),
                ('effective_to', models.DateField(blank=True, help_text='Date this pricing expires (null = no end date)', null=True)),
                ('total_price', models.DecimalField(decimal_places=2, help_text='Total all-inclusive course price (excl. VAT)', max_digits=12, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))])),
                ('deposit_required', models.BooleanField(default=True)),
                ('deposit_type', models.CharField(choices=[('FIXED', 'Fixed Amount'), ('PERCENTAGE', 'Percentage of Total')], default='FIXED', max_length=10)),
                ('deposit_amount', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Fixed deposit amount (if deposit_type=FIXED)', max_digits=10)),
                ('deposit_percentage', models.DecimalField(decimal_places=2, default=Decimal('10.00'), help_text='Deposit as percentage of total (if deposit_type=PERCENTAGE)', max_digits=5)),
                ('registration_fee', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='One-time registration fee (included in total)', max_digits=10)),
                ('material_fee', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Learning materials fee (included in total)', max_digits=10)),
                ('assessment_fee', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Assessment/examination fee (included in total)', max_digits=10)),
                ('certification_fee', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Certification/graduation fee (included in total)', max_digits=10)),
                ('vat_rate', models.DecimalField(decimal_places=2, default=Decimal('15.00'), help_text='VAT rate percentage', max_digits=5)),
                ('prices_include_vat', models.BooleanField(default=False, help_text='Are the entered prices VAT inclusive?')),
                ('early_bird_discount_percent', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Early bird discount percentage', max_digits=5)),
                ('early_bird_deadline_days', models.PositiveIntegerField(default=0, help_text='Days before course start for early bird eligibility')),
                ('submitted_at', models.DateTimeField(blank=True, null=True)),
                ('approved_at', models.DateTimeField(blank=True, null=True)),
                ('rejection_reason', models.TextField(blank=True)),
                ('approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='approved_course_pricing', to=settings.AUTH_USER_MODEL)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(class)s_created', to=settings.AUTH_USER_MODEL)),
                ('deleted_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_deleted', to=settings.AUTH_USER_MODEL)),
                ('previous_version', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='next_versions', to='finance.coursepricing')),
                ('qualification', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='pricing_versions', to='academics.qualification')),
                ('submitted_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='submitted_course_pricing', to=settings.AUTH_USER_MODEL)),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(class)s_updated', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Course Pricing',
                'verbose_name_plural': 'Course Pricing',
                'ordering': ['-effective_from', '-version'],
            },
        ),
        migrations.CreateModel(
            name='PaymentTerm',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_deleted', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('name', models.CharField(help_text='Term name (e.g., "Monthly x12", "Upfront Payment")', max_length=100)),
                ('code', models.CharField(max_length=20, unique=True)),
                ('description', models.TextField(blank=True)),
                ('payment_type', models.CharField(choices=[('FULL', 'Full Payment'), ('DEPOSIT_BALANCE', 'Deposit + Balance'), ('MONTHLY', 'Monthly Instalments'), ('QUARTERLY', 'Quarterly Instalments'), ('PER_SEMESTER', 'Per Semester'), ('PER_YEAR', 'Per Year'), ('CUSTOM', 'Custom Schedule')], max_length=20)),
                ('number_of_instalments', models.PositiveIntegerField(default=1, help_text='Total number of payments (including deposit if separate)')),
                ('instalment_frequency_days', models.PositiveIntegerField(default=30, help_text='Days between instalments (e.g., 30 for monthly)')),
                ('deposit_with_application', models.BooleanField(default=True, help_text='Is deposit required with application?')),
                ('balance_due_before_start', models.BooleanField(default=False, help_text='Must full balance be paid before course starts?')),
                ('balance_due_days', models.PositiveIntegerField(default=0, help_text='Days before course start that balance is due (if applicable)')),
                ('discount_percentage', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Discount for choosing this term (e.g., 5% for upfront payment)', max_digits=5)),
                ('admin_fee', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Admin fee for this payment term', max_digits=10)),
                ('interest_rate', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Interest rate for instalment plans (annual %)', max_digits=5)),
                ('is_active', models.BooleanField(default=True)),
                ('available_for_self_funded', models.BooleanField(default=True, help_text='Available for self-paying learners')),
                ('available_for_sponsored', models.BooleanField(default=True, help_text='Available for sponsored/corporate learners')),
                ('min_course_value', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Minimum course value for this term to be available', max_digits=10)),
                ('max_course_value', models.DecimalField(blank=True, decimal_places=2, help_text='Maximum course value for this term (null = no max)', max_digits=10, null=True)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(class)s_created', to=settings.AUTH_USER_MODEL)),
                ('deleted_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_deleted', to=settings.AUTH_USER_MODEL)),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(class)s_updated', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Payment Term',
                'verbose_name_plural': 'Payment Terms',
                'ordering': ['name'],
            },
        ),
        migrations.CreateModel(
            name='PricingStrategy',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_deleted', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('name', models.CharField(help_text='Strategy name (e.g., "Metro Pricing", "Rural Discount")', max_length=100)),
                ('code', models.CharField(help_text='Unique code for the strategy', max_length=20, unique=True)),
                ('description', models.TextField(blank=True)),
                ('strategy_type', models.CharField(choices=[('STANDARD', 'Standard (Brand Default)'), ('REGIONAL', 'Regional Variation'), ('CAMPUS', 'Campus-Specific'), ('CORPORATE', 'Corporate Client'), ('PROMOTIONAL', 'Promotional/Seasonal')], default='STANDARD', max_length=20)),
                ('priority', models.PositiveIntegerField(default=0, help_text='Higher priority strategies are applied first in price resolution')),
                ('is_active', models.BooleanField(default=True)),
                ('is_default', models.BooleanField(default=False, help_text='Default strategy for this brand (only one per brand)')),
                ('brand', models.ForeignKey(help_text='Brand this strategy belongs to', on_delete=django.db.models.deletion.CASCADE, related_name='pricing_strategies', to='tenants.brand')),
                ('campus', models.ForeignKey(blank=True, help_text='Campus for CAMPUS type strategies', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='pricing_strategies', to='tenants.campus')),
                ('corporate_client', models.ForeignKey(blank=True, help_text='Corporate client for CORPORATE type strategies', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='pricing_strategies', to='corporate.corporateclient')),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(class)s_created', to=settings.AUTH_USER_MODEL)),
                ('deleted_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_deleted', to=settings.AUTH_USER_MODEL)),
                ('region', models.ForeignKey(blank=True, help_text='Region for REGIONAL type strategies', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='pricing_strategies', to='core.region')),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(class)s_updated', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Pricing Strategy',
                'verbose_name_plural': 'Pricing Strategies',
                'ordering': ['-priority', 'name'],
            },
        ),
        migrations.CreateModel(
            name='FuturePricingSchedule',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_deleted', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('name', models.CharField(help_text='Schedule name (e.g., "2026-2029 Annual Increases")', max_length=100)),
                ('description', models.TextField(blank=True)),
                ('base_year', models.PositiveIntegerField(help_text='The starting year for this pricing schedule')),
                ('escalation_type', models.CharField(choices=[('FIXED_PERCENT', 'Fixed Percentage'), ('CPI_LINKED', 'CPI Linked'), ('CUSTOM', 'Custom per Year')], default='FIXED_PERCENT', max_length=20)),
                ('default_escalation_percent', models.DecimalField(decimal_places=2, default=Decimal('6.00'), help_text='Default annual escalation percentage (auto-filled, can be overridden per year)', max_digits=5)),
                ('apply_from_month', models.PositiveIntegerField(default=1, help_text='Month when new prices take effect (1-12)')),
                ('apply_from_day', models.PositiveIntegerField(default=1, help_text='Day of month when new prices take effect')),
                ('status', models.CharField(choices=[('DRAFT', 'Draft'), ('PENDING_APPROVAL', 'Pending Approval'), ('APPROVED', 'Approved'), ('APPLIED', 'Applied')], default='DRAFT', max_length=20)),
                ('approved_at', models.DateTimeField(blank=True, null=True)),
                ('is_active', models.BooleanField(default=True)),
                ('approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='approved_pricing_schedules', to=settings.AUTH_USER_MODEL)),
                ('brand', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='future_pricing_schedules', to='tenants.brand')),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(class)s_created', to=settings.AUTH_USER_MODEL)),
                ('deleted_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_deleted', to=settings.AUTH_USER_MODEL)),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(class)s_updated', to=settings.AUTH_USER_MODEL)),
                ('base_strategy', models.ForeignKey(help_text='The pricing strategy to apply escalation to', on_delete=django.db.models.deletion.CASCADE, related_name='future_schedules', to='finance.pricingstrategy')),
            ],
            options={
                'verbose_name': 'Future Pricing Schedule',
                'verbose_name_plural': 'Future Pricing Schedules',
                'ordering': ['-base_year'],
            },
        ),
        migrations.CreateModel(
            name='CoursePricingOverride',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('override_type', models.CharField(choices=[('FIXED', 'Fixed Price Override'), ('MODIFIER', 'Percentage Modifier'), ('DISCOUNT', 'Fixed Discount'), ('DISCOUNT_PERCENT', 'Percentage Discount')], max_length=20)),
                ('override_price', models.DecimalField(blank=True, decimal_places=2, help_text='Fixed override price (for FIXED type)', max_digits=12, null=True)),
                ('modifier_percent', models.DecimalField(blank=True, decimal_places=2, help_text='Percentage modifier (for MODIFIER type, e.g., 110 = +10%)', max_digits=6, null=True)),
                ('discount_amount', models.DecimalField(blank=True, decimal_places=2, help_text='Fixed discount amount (for DISCOUNT type)', max_digits=10, null=True)),
                ('discount_percent', models.DecimalField(blank=True, decimal_places=2, help_text='Discount percentage (for DISCOUNT_PERCENT type)', max_digits=5, null=True)),
                ('reason', models.TextField(blank=True, help_text='Reason for this override')),
                ('is_active', models.BooleanField(default=True)),
                ('pricing', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='overrides', to='finance.coursepricing')),
                ('target_strategy', models.ForeignKey(help_text='The strategy this override applies to', on_delete=django.db.models.deletion.CASCADE, related_name='price_overrides', to='finance.pricingstrategy')),
            ],
            options={
                'verbose_name': 'Course Pricing Override',
                'verbose_name_plural': 'Course Pricing Overrides',
                'ordering': ['pricing', 'target_strategy'],
            },
        ),
        migrations.AddField(
            model_name='coursepricing',
            name='pricing_strategy',
            field=models.ForeignKey(help_text='Pricing strategy that determines scope and priority', on_delete=django.db.models.deletion.PROTECT, related_name='course_pricing', to='finance.pricingstrategy'),
        ),
        migrations.CreateModel(
            name='CoursePricingHistory',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('change_type', models.CharField(choices=[('CREATED', 'Created'), ('UPDATED', 'Updated'), ('SUBMITTED', 'Submitted for Approval'), ('APPROVED', 'Approved'), ('REJECTED', 'Rejected'), ('ACTIVATED', 'Activated'), ('SUPERSEDED', 'Superseded'), ('ARCHIVED', 'Archived')], max_length=20)),
                ('changed_at', models.DateTimeField(auto_now_add=True)),
                ('old_total_price', models.DecimalField(blank=True, decimal_places=2, max_digits=12, null=True)),
                ('new_total_price', models.DecimalField(blank=True, decimal_places=2, max_digits=12, null=True)),
                ('old_status', models.CharField(blank=True, max_length=20)),
                ('new_status', models.CharField(blank=True, max_length=20)),
                ('snapshot', models.JSONField(blank=True, help_text='Complete snapshot of pricing at time of change', null=True)),
                ('change_reason', models.TextField(blank=True)),
                ('changed_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='pricing_changes', to=settings.AUTH_USER_MODEL)),
                ('pricing', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='history', to='finance.coursepricing')),
            ],
            options={
                'verbose_name': 'Course Pricing History',
                'verbose_name_plural': 'Course Pricing History',
                'ordering': ['-changed_at'],
                'indexes': [models.Index(fields=['pricing', 'changed_at'], name='finance_cou_pricing_8582e3_idx'), models.Index(fields=['change_type'], name='finance_cou_change__ea6d09_idx')],
            },
        ),
        migrations.CreateModel(
            name='CoursePricingYear',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('year_number', models.PositiveIntegerField(help_text='Year of study (1, 2, 3, etc.)')),
                ('year_label', models.CharField(blank=True, help_text='Optional label (e.g., "Foundation Year", "Specialization Year")', max_length=50)),
                ('tuition_fee', models.DecimalField(decimal_places=2, help_text='Tuition fee for this year', max_digits=10, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))])),
                ('material_fee', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Material fee for this year', max_digits=10)),
                ('assessment_fee', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Assessment/exam fee for this year', max_digits=10)),
                ('other_fees', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Any other fees for this year', max_digits=10)),
                ('credits', models.PositiveIntegerField(default=0, help_text='Credits to be completed this year')),
                ('notes', models.TextField(blank=True)),
                ('pricing', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='yearly_pricing', to='finance.coursepricing')),
            ],
            options={
                'verbose_name': 'Course Pricing Year',
                'verbose_name_plural': 'Course Pricing Years',
                'ordering': ['pricing', 'year_number'],
                'unique_together': {('pricing', 'year_number')},
            },
        ),
        migrations.CreateModel(
            name='FuturePricingYear',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('year', models.PositiveIntegerField(help_text='Calendar year this applies to')),
                ('year_offset', models.PositiveIntegerField(help_text='Years from base year (0-4+)')),
                ('escalation_percent', models.DecimalField(decimal_places=2, help_text='Escalation percentage for this year (0 for base year)', max_digits=5)),
                ('is_manually_set', models.BooleanField(default=False, help_text='Has this escalation been manually overridden?')),
                ('is_locked', models.BooleanField(default=False, help_text='Locked years cannot be modified')),
                ('is_applied', models.BooleanField(default=False, help_text='Has this year pricing been applied?')),
                ('applied_at', models.DateTimeField(blank=True, null=True)),
                ('notes', models.TextField(blank=True)),
                ('schedule', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='years', to='finance.futurepricingschedule')),
            ],
            options={
                'verbose_name': 'Future Pricing Year',
                'verbose_name_plural': 'Future Pricing Years',
                'ordering': ['schedule', 'year'],
                'unique_together': {('schedule', 'year')},
            },
        ),
        migrations.CreateModel(
            name='CoursePricingPaymentTerm',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('override_discount', models.DecimalField(blank=True, decimal_places=2, help_text='Override the default discount for this course', max_digits=5, null=True)),
                ('override_instalments', models.PositiveIntegerField(blank=True, help_text='Override the number of instalments for this course', null=True)),
                ('override_admin_fee', models.DecimalField(blank=True, decimal_places=2, help_text='Override the admin fee for this course', max_digits=10, null=True)),
                ('is_default', models.BooleanField(default=False, help_text='Is this the default payment term for this course?')),
                ('is_available', models.BooleanField(default=True, help_text='Is this payment term available for this course?')),
                ('pricing', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='available_payment_terms', to='finance.coursepricing')),
                ('payment_term', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='course_pricing', to='finance.paymentterm')),
            ],
            options={
                'verbose_name': 'Course Payment Term',
                'verbose_name_plural': 'Course Payment Terms',
                'ordering': ['pricing', '-is_default', 'payment_term__name'],
                'unique_together': {('pricing', 'payment_term')},
            },
        ),
        migrations.AddIndex(
            model_name='pricingstrategy',
            index=models.Index(fields=['brand', 'strategy_type', 'is_active'], name='finance_pri_brand_i_9b57b6_idx'),
        ),
        migrations.AddIndex(
            model_name='pricingstrategy',
            index=models.Index(fields=['priority'], name='finance_pri_priorit_1df42d_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='futurepricingschedule',
            unique_together={('brand', 'base_strategy', 'base_year')},
        ),
        migrations.AlterUniqueTogether(
            name='coursepricingoverride',
            unique_together={('pricing', 'target_strategy')},
        ),
        migrations.AddIndex(
            model_name='coursepricing',
            index=models.Index(fields=['qualification', 'pricing_strategy', 'status'], name='finance_cou_qualifi_30c355_idx'),
        ),
        migrations.AddIndex(
            model_name='coursepricing',
            index=models.Index(fields=['effective_from', 'effective_to'], name='finance_cou_effecti_c666d0_idx'),
        ),
        migrations.AddIndex(
            model_name='coursepricing',
            index=models.Index(fields=['status'], name='finance_cou_status_3ad60a_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='coursepricing',
            unique_together={('qualification', 'pricing_strategy', 'version')},
        ),
    ]

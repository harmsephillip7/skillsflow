# Generated by Django 5.2.8 on 2026-01-08 08:17

import django.core.validators
import django.db.models.deletion
import uuid
from decimal import Decimal
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('academics', '0009_alter_implementationmoduleslot_options_and_more'),
        ('learners', '0011_workplaceexposurelog_workplacerotationrecommendation'),
        ('tenants', '0002_extend_campus_code_length'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='Tender',
            fields=[
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_deleted', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('reference_number', models.CharField(db_index=True, help_text='Official tender reference number', max_length=100)),
                ('title', models.CharField(max_length=500)),
                ('description', models.TextField(blank=True)),
                ('source_url', models.URLField(blank=True, help_text='Direct URL to tender details')),
                ('funder', models.CharField(blank=True, help_text='Funding organization name', max_length=200)),
                ('funder_type', models.CharField(blank=True, help_text='Type: SETA, Government, Private', max_length=50)),
                ('region', models.CharField(blank=True, help_text='Geographic region', max_length=100)),
                ('published_date', models.DateField(blank=True, help_text='Date tender was published', null=True)),
                ('opening_date', models.DateField(blank=True, help_text='Date tender window opens', null=True)),
                ('closing_date', models.DateField(blank=True, help_text='Deadline for submissions', null=True)),
                ('expected_award_date', models.DateField(blank=True, help_text='Expected date of award announcement', null=True)),
                ('discovered_at', models.DateTimeField(auto_now_add=True)),
                ('estimated_value', models.DecimalField(blank=True, decimal_places=2, help_text='Estimated total tender value', max_digits=15, null=True)),
                ('currency', models.CharField(default='ZAR', max_length=3)),
                ('status', models.CharField(choices=[('DISCOVERED', 'Discovered'), ('REVIEWING', 'Under Review'), ('APPLICABLE', 'Applicable - Will Apply'), ('NOT_APPLICABLE', 'Not Applicable'), ('APPLIED', 'Application Submitted'), ('ACKNOWLEDGED', 'Acknowledgement Received'), ('PENDING', 'Pending Decision'), ('APPROVED', 'Approved'), ('PARTIALLY_APPROVED', 'Partially Approved'), ('REJECTED', 'Rejected'), ('CANCELLED', 'Tender Cancelled'), ('EXPIRED', 'Expired - Not Applied')], default='DISCOVERED', max_length=20)),
                ('priority', models.CharField(choices=[('HIGH', 'High'), ('MEDIUM', 'Medium'), ('LOW', 'Low')], default='MEDIUM', max_length=10)),
                ('requirements_summary', models.TextField(blank=True, help_text='Summary of key requirements')),
                ('eligibility_notes', models.TextField(blank=True, help_text='Notes on eligibility criteria')),
                ('notes', models.TextField(blank=True, help_text='Internal notes')),
                ('tags', models.JSONField(blank=True, default=list, help_text='Tags for filtering')),
                ('assigned_to', models.ForeignKey(blank=True, help_text='Staff member responsible for this tender', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='assigned_tenders', to=settings.AUTH_USER_MODEL)),
                ('campus', models.ForeignKey(blank=True, help_text='Optional campus association', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='tenders', to='tenants.campus')),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(class)s_created', to=settings.AUTH_USER_MODEL)),
                ('deleted_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_deleted', to=settings.AUTH_USER_MODEL)),
                ('seta', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='tenders', to='learners.seta')),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(class)s_updated', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Tender',
                'verbose_name_plural': 'Tenders',
                'ordering': ['-closing_date', '-discovered_at'],
                'permissions': [('can_manage_tenders', 'Can manage tender pipeline'), ('can_apply_tenders', 'Can submit tender applications'), ('can_view_tender_analytics', 'Can view tender analytics')],
            },
        ),
        migrations.CreateModel(
            name='TenderApplication',
            fields=[
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_deleted', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('status', models.CharField(choices=[('PREPARING', 'Preparing'), ('SUBMITTED', 'Submitted'), ('ACKNOWLEDGED', 'Acknowledgement Received'), ('UNDER_EVALUATION', 'Under Evaluation'), ('SHORTLISTED', 'Shortlisted'), ('APPROVED', 'Approved'), ('PARTIALLY_APPROVED', 'Partially Approved'), ('REJECTED', 'Rejected'), ('WITHDRAWN', 'Withdrawn')], default='PREPARING', max_length=20)),
                ('preparation_started_at', models.DateTimeField(blank=True, null=True)),
                ('submitted_at', models.DateTimeField(blank=True, null=True)),
                ('acknowledged_at', models.DateTimeField(blank=True, null=True)),
                ('acknowledgement_reference', models.CharField(blank=True, max_length=100)),
                ('decision_at', models.DateTimeField(blank=True, null=True)),
                ('total_learners', models.PositiveIntegerField(default=0, help_text='Total learners across all qualifications')),
                ('total_amount', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Total tender amount applied for', max_digits=15)),
                ('course_types', models.JSONField(default=list, help_text='List of course/qualification types included')),
                ('approved_learners', models.PositiveIntegerField(blank=True, null=True)),
                ('approved_amount', models.DecimalField(blank=True, decimal_places=2, max_digits=15, null=True)),
                ('rejection_reason', models.TextField(blank=True)),
                ('current_probability', models.DecimalField(decimal_places=4, default=Decimal('0.7000'), help_text='Current success probability (0-1)', max_digits=5, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(1)])),
                ('probability_override', models.DecimalField(blank=True, decimal_places=4, help_text='Manual probability override (if set, ignores calculated probability)', max_digits=5, null=True, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(1)])),
                ('last_probability_update', models.DateTimeField(blank=True, null=True)),
                ('expected_revenue', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Probability-weighted expected revenue', max_digits=15)),
                ('funder_contact_name', models.CharField(blank=True, max_length=200)),
                ('funder_contact_email', models.EmailField(blank=True, max_length=254)),
                ('funder_contact_phone', models.CharField(blank=True, max_length=20)),
                ('notes', models.TextField(blank=True)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(class)s_created', to=settings.AUTH_USER_MODEL)),
                ('deleted_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_deleted', to=settings.AUTH_USER_MODEL)),
                ('tender', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='applications', to='tenders.tender')),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(class)s_updated', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Tender Application',
                'verbose_name_plural': 'Tender Applications',
                'ordering': ['-submitted_at', '-created_at'],
            },
        ),
        migrations.CreateModel(
            name='TenderDocument',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_deleted', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('name', models.CharField(max_length=200)),
                ('category', models.CharField(choices=[('TENDER_DOCUMENT', 'Original Tender Document'), ('REQUIREMENTS', 'Requirements Document'), ('APPLICATION', 'Application Form'), ('SUBMISSION', 'Submission Document'), ('SUPPORTING', 'Supporting Document'), ('ACKNOWLEDGEMENT', 'Acknowledgement'), ('AWARD', 'Award Letter'), ('CONTRACT', 'Contract'), ('OTHER', 'Other')], default='OTHER', max_length=20)),
                ('file', models.FileField(upload_to='tenders/documents/%Y/%m/')),
                ('file_size', models.PositiveIntegerField(default=0, help_text='File size in bytes')),
                ('mime_type', models.CharField(blank=True, max_length=100)),
                ('description', models.TextField(blank=True)),
                ('is_required', models.BooleanField(default=False, help_text='Is this a required submission document?')),
                ('is_submitted', models.BooleanField(default=False, help_text='Has this been submitted with the application?')),
                ('application', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='documents', to='tenders.tenderapplication')),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(class)s_created', to=settings.AUTH_USER_MODEL)),
                ('deleted_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_deleted', to=settings.AUTH_USER_MODEL)),
                ('tender', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='documents', to='tenders.tender')),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(class)s_updated', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Tender Document',
                'verbose_name_plural': 'Tender Documents',
                'ordering': ['category', 'name'],
            },
        ),
        migrations.CreateModel(
            name='TenderNote',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_deleted', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('note_type', models.CharField(choices=[('STATUS_CHANGE', 'Status Change'), ('COMMENT', 'Comment'), ('CALL', 'Phone Call'), ('EMAIL', 'Email'), ('MEETING', 'Meeting'), ('REMINDER', 'Reminder'), ('SYSTEM', 'System Generated')], default='COMMENT', max_length=20)),
                ('content', models.TextField()),
                ('old_status', models.CharField(blank=True, max_length=20)),
                ('new_status', models.CharField(blank=True, max_length=20)),
                ('reminder_date', models.DateTimeField(blank=True, null=True)),
                ('reminder_sent', models.BooleanField(default=False)),
                ('application', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='timeline_notes', to='tenders.tenderapplication')),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(class)s_created', to=settings.AUTH_USER_MODEL)),
                ('deleted_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_deleted', to=settings.AUTH_USER_MODEL)),
                ('tender', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='timeline_notes', to='tenders.tender')),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(class)s_updated', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Tender Note',
                'verbose_name_plural': 'Tender Notes',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='TenderNotificationRule',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_deleted', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('name', models.CharField(max_length=100)),
                ('is_active', models.BooleanField(default=True)),
                ('trigger', models.CharField(choices=[('CLOSING_SOON', 'Tender Closing Soon'), ('NEW_TENDER', 'New Tender Discovered'), ('PROBABILITY_DROP', 'Probability Dropped Below Threshold'), ('NO_UPDATE', 'No Update for X Days'), ('MATCH_CRITERIA', 'Matches Search Criteria'), ('STATUS_CHANGE', 'Status Changed')], max_length=20)),
                ('trigger_config', models.JSONField(default=dict, help_text="Trigger-specific configuration:\n        - CLOSING_SOON: {days_before: 7}\n        - PROBABILITY_DROP: {threshold: 0.3}\n        - NO_UPDATE: {days: 14}\n        - MATCH_CRITERIA: {funder: 'SETA', region: 'Gauteng', min_value: 100000}\n        ")),
                ('channel', models.CharField(choices=[('EMAIL', 'Email'), ('SMS', 'SMS'), ('PUSH', 'Push Notification'), ('SLACK', 'Slack'), ('TEAMS', 'Microsoft Teams')], default='EMAIL', max_length=20)),
                ('recipients', models.JSONField(default=list, help_text='List of user IDs or email addresses')),
                ('subject_template', models.CharField(blank=True, max_length=200)),
                ('body_template', models.TextField(blank=True)),
                ('cooldown_hours', models.PositiveIntegerField(default=24, help_text='Minimum hours between notifications of this type')),
                ('last_triggered_at', models.DateTimeField(blank=True, null=True)),
                ('total_triggered', models.PositiveIntegerField(default=0)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(class)s_created', to=settings.AUTH_USER_MODEL)),
                ('deleted_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_deleted', to=settings.AUTH_USER_MODEL)),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(class)s_updated', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Notification Rule',
                'verbose_name_plural': 'Notification Rules',
                'ordering': ['trigger', 'name'],
            },
        ),
        migrations.CreateModel(
            name='TenderSegment',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_deleted', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('name', models.CharField(max_length=100, unique=True)),
                ('slug', models.SlugField(max_length=100, unique=True)),
                ('segment_type', models.CharField(choices=[('FUNDER', 'By Funder'), ('REGION', 'By Region'), ('TYPE', 'By Tender Type'), ('SETA', 'By SETA'), ('VALUE', 'By Value Range'), ('CUSTOM', 'Custom Segment')], default='CUSTOM', max_length=20)),
                ('description', models.TextField(blank=True)),
                ('decay_model', models.CharField(choices=[('LINEAR', 'Linear Decay'), ('EXPONENTIAL', 'Exponential Decay'), ('STEP', 'Step Function'), ('CUSTOM', 'Custom Curve')], default='EXPONENTIAL', help_text='Mathematical model for probability decay over time', max_length=20)),
                ('initial_probability', models.DecimalField(decimal_places=4, default=Decimal('0.7000'), help_text='Starting probability immediately after submission (0-1)', max_digits=5, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(1)])),
                ('decay_rate', models.DecimalField(decimal_places=5, default=Decimal('0.01500'), help_text='Daily decay rate (for linear: amount per day, for exponential: lambda)', max_digits=7)),
                ('floor_probability', models.DecimalField(decimal_places=4, default=Decimal('0.0500'), help_text='Minimum probability floor (never drops below this)', max_digits=5, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(1)])),
                ('expected_response_days', models.PositiveIntegerField(default=90, help_text='Typical days until response for this segment')),
                ('total_applications', models.PositiveIntegerField(default=0)),
                ('successful_applications', models.PositiveIntegerField(default=0)),
                ('total_value_applied', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('total_value_won', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('step_thresholds', models.JSONField(blank=True, default=list, help_text='For step function: list of {days: X, probability: Y} thresholds')),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(class)s_created', to=settings.AUTH_USER_MODEL)),
                ('deleted_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_deleted', to=settings.AUTH_USER_MODEL)),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(class)s_updated', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Tender Segment',
                'verbose_name_plural': 'Tender Segments',
                'ordering': ['segment_type', 'name'],
            },
        ),
        migrations.AddField(
            model_name='tender',
            name='segment',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='tenders', to='tenders.tendersegment'),
        ),
        migrations.CreateModel(
            name='TenderSource',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_deleted', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('name', models.CharField(help_text="Source name (e.g., 'eTender Portal')", max_length=200)),
                ('slug', models.SlugField(max_length=100, unique=True)),
                ('base_url', models.URLField(help_text='Base URL for the tender source')),
                ('scraper_type', models.CharField(choices=[('BEAUTIFULSOUP', 'BeautifulSoup (Simple HTML)'), ('PLAYWRIGHT', 'Playwright (JavaScript-heavy)'), ('RSS', 'RSS Feed'), ('API', 'API Endpoint')], default='BEAUTIFULSOUP', max_length=20)),
                ('scrape_config', models.JSONField(default=dict, help_text='Scraper configuration including:\n        - list_url: URL pattern for tender listings\n        - selectors: CSS/XPath selectors for data extraction\n        - pagination: Pagination handling config\n        - auth: Authentication config if needed\n        - headers: Custom headers to send\n        ')),
                ('scrape_frequency_hours', models.PositiveIntegerField(default=24, help_text='How often to scrape this source (in hours)')),
                ('last_scraped_at', models.DateTimeField(blank=True, null=True)),
                ('next_scrape_at', models.DateTimeField(blank=True, null=True)),
                ('status', models.CharField(choices=[('ACTIVE', 'Active'), ('PAUSED', 'Paused'), ('ERROR', 'Error'), ('DISABLED', 'Disabled')], default='ACTIVE', max_length=20)),
                ('status_message', models.TextField(blank=True)),
                ('consecutive_failures', models.PositiveIntegerField(default=0)),
                ('max_failures_before_pause', models.PositiveIntegerField(default=5)),
                ('total_tenders_found', models.PositiveIntegerField(default=0)),
                ('last_tenders_found', models.PositiveIntegerField(default=0)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(class)s_created', to=settings.AUTH_USER_MODEL)),
                ('default_segment', models.ForeignKey(blank=True, help_text='Default segment for tenders found from this source', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='sources', to='tenders.tendersegment')),
                ('deleted_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_deleted', to=settings.AUTH_USER_MODEL)),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='%(class)s_updated', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Tender Source',
                'verbose_name_plural': 'Tender Sources',
                'ordering': ['name'],
            },
        ),
        migrations.AddField(
            model_name='tender',
            name='source',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='tenders', to='tenders.tendersource'),
        ),
        migrations.CreateModel(
            name='TenderQualification',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('unit_price', models.DecimalField(blank=True, decimal_places=2, help_text='Price per learner for this qualification', max_digits=10, null=True)),
                ('min_learners', models.PositiveIntegerField(default=1)),
                ('max_learners', models.PositiveIntegerField(blank=True, null=True)),
                ('proposed_learners', models.PositiveIntegerField(blank=True, null=True)),
                ('approved_learners', models.PositiveIntegerField(blank=True, null=True)),
                ('approved_unit_price', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ('notes', models.TextField(blank=True)),
                ('qualification', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='tenders', to='academics.qualification')),
                ('tender', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='qualifications', to='tenders.tender')),
            ],
            options={
                'verbose_name': 'Tender Qualification',
                'verbose_name_plural': 'Tender Qualifications',
                'unique_together': {('tender', 'qualification')},
            },
        ),
        migrations.AlterUniqueTogether(
            name='tender',
            unique_together={('reference_number', 'source')},
        ),
    ]
